module.exports=[270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},878830,e=>e.a(async(t,r)=>{try{let t=await e.y("stripe");e.n(t),r()}catch(e){r(e)}},!0),66382,e=>e.a(async(t,r)=>{try{var s=e.i(878830),a=t([s]);[s]=a.then?(await a)():a;let i=new s.default(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16"});e.s(["default",0,i]),r()}catch(e){r(e)}},!1),537353,e=>e.a(async(t,r)=>{try{var s=e.i(66382),a=t([s]);async function i(e,t){if("OPTIONS"===e.method)return t.setHeader("Access-Control-Allow-Methods","POST"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),t.status(200).end();if("POST"!==e.method)return t.status(405).json({success:!1,error:"Method not allowed",code:"METHOD_NOT_ALLOWED"});try{if(!s.default)return console.error("Stripe non inizializzato"),t.status(500).json({success:!1,error:"Stripe non configurato correttamente",code:"STRIPE_NOT_CONFIGURED"});let{priceId:r,userId:a,userEmail:i}=e.body;if(!r)return t.status(400).json({success:!1,error:"priceId è richiesto",code:"MISSING_PRICE_ID"});if(!i)return t.status(400).json({success:!1,error:"userEmail è richiesto",code:"MISSING_EMAIL"});let o="http://localhost:3000";try{if(!(await s.default.prices.retrieve(r)).active)throw Error(`Il price ID ${r} non \xe8 attivo in Stripe`)}catch(e){if(console.error("[Stripe Checkout] Price retrieval error:",e),"StripeInvalidRequestError"===e.type&&"resource_missing"===e.code)return t.status(400).json({success:!1,error:`Price ID non valido: ${r}. Verifica che il price ID sia corretto e attivo nel tuo account Stripe.`,code:"INVALID_PRICE_ID",details:void 0});throw e}let n=await s.default.checkout.sessions.create({mode:"subscription",payment_method_types:["card"],line_items:[{price:r,quantity:1}],success_url:`${o}/dashboard?success=true&session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${o}/pricing?canceled=true`,customer_email:i,metadata:{userId:a||"unknown"},allow_promotion_codes:!0,billing_address_collection:"required",subscription_data:{metadata:{userId:a||"unknown"}}});if(!n||!n.url)throw Error("Stripe non ha restituito un URL di checkout valido");t.status(200).json({success:!0,url:n.url})}catch(e){if(console.error("[Stripe Checkout] Error:",{message:e.message,type:e.type,code:e.code,statusCode:e.statusCode}),"StripeInvalidRequestError"===e.type){if("resource_missing"===e.code)return t.status(400).json({success:!1,error:`Risorsa Stripe non trovata: ${e.message}`,code:"STRIPE_RESOURCE_MISSING",details:void 0});return t.status(400).json({success:!1,error:`Errore nella richiesta a Stripe: ${e.message}`,code:"STRIPE_INVALID_REQUEST",details:void 0})}t.status(500).json({success:!1,error:e.message||"Errore durante la creazione della sessione di checkout",code:"CHECKOUT_ERROR",details:void 0})}}[s]=a.then?(await a)():a,e.s(["default",()=>i]),r()}catch(e){r(e)}},!1),729256,e=>e.a(async(t,r)=>{try{var s=e.i(926747),a=e.i(190406),i=e.i(244898),o=e.i(262950),n=e.i(537353),c=e.i(7031),l=e.i(181927),u=e.i(846432),d=t([n]);[n]=d.then?(await d)():d;let h=(0,o.hoist)(n,"default"),S=(0,o.hoist)(n,"config"),m=new i.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/stripe/create-checkout-session",pathname:"/api/stripe/create-checkout-session",bundlePath:"",filename:""},userland:n,distDir:".next-build",relativeProjectDir:""});async function p(e,t,r){m.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/stripe/create-checkout-session";a=a.replace(/\/index$/,"")||"/";let i=await m.prepare(e,t,{srcPage:a});if(!i){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:o,params:n,prerenderManifest:d,routerServerContext:p}=i;try{let r=e.method||"GET",s=(0,c.getTracer)(),i=s.getActiveScopeSpan(),u=m.instrumentationOnRequestError.bind(m),h=async i=>m.render(e,t,{query:{...o,...n},params:n,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:d.preview,propagateError:!1,dev:m.isDev,page:"/api/stripe/create-checkout-session",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${r} ${o}`;i.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),i.updateName(e)}else i.updateName(`${r} ${a}`)});i?await h(i):await s.withPropagatedContext(e.headers,()=>s.trace(l.BaseServerSpan.handleRequest,{spanName:`${r} ${a}`,kind:c.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},h))}catch(e){if(m.isDev)throw e;(0,s.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,S,"default",0,h,"handler",()=>p]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__47ddee1d._.js.map