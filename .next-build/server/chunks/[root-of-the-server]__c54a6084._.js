module.exports=[267370,e=>e.a(async(r,t)=>{try{var a=e.i(74538),i=r([a]);[a]=i.then?(await i)():i;let E=new a.default({apiKey:process.env.OPENAI_API_KEY});async function o(e){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{return(await E.embeddings.create({model:"text-embedding-3-small",input:e.substring(0,8e3)})).data[0].embedding}catch(e){throw console.error("Error generating embedding:",e),Error(`Failed to generate embedding: ${e.message}`)}}async function n(e){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");if(!Array.isArray(e)||0===e.length)return[];try{return(await E.embeddings.create({model:"text-embedding-3-small",input:e.map(e=>(e||"").toString().substring(0,8e3))})).data.map(e=>e.embedding)}catch(e){throw console.error("Error generating batch embeddings:",e),Error(`Failed to generate batch embeddings: ${e.message}`)}}async function s(e,r={}){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{return(await E.chat.completions.create({model:r.model||"gpt-4o-mini",messages:e,temperature:r.temperature||.7,max_tokens:r.max_tokens||1e3,top_p:r.top_p||1,frequency_penalty:r.frequency_penalty||0,presence_penalty:r.presence_penalty||0})).choices[0].message.content}catch(e){if(console.error("Error in chat completion:",e),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(500===e.status)throw Error("Errore del server OpenAI. Riprova più tardi.");throw Error(`Errore nella comunicazione con OpenAI: ${e.message}`)}}async function l(e,r=200){let t=[{role:"system",content:"You are a helpful assistant that creates concise summaries."},{role:"user",content:`Summarize the following text in ${r} words or less:

${e}`}];return await s(t,{temperature:.5,max_tokens:300})}async function c(e,r=5){let t=[{role:"system",content:"You are a helpful assistant that generates relevant tags for documents. Return only comma-separated tags, no explanations."},{role:"user",content:`Generate ${r} relevant tags for this document:

${e.substring(0,2e3)}`}];return(await s(t,{temperature:.3,max_tokens:100})).split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0).slice(0,r)}async function m(e){let r=["contract","invoice","report","presentation","spreadsheet","image","code","email","article","other"],t=[{role:"system",content:`You are a document classifier. Classify the document into one or more of these categories: ${r.join(", ")}. Return only category names, comma-separated.`},{role:"user",content:`Classify this document:

${e.substring(0,1e3)}`}];return(await s(t,{temperature:.2,max_tokens:50})).split(",").map(e=>e.trim().toLowerCase()).filter(e=>r.includes(e))}async function u(e,r,t="Cosa contiene questa immagine? Descrivi tutto ciò che vedi."){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let a=e.toString("base64");return(await E.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"Sei un assistente AI esperto nell'analisi di immagini. Descrivi in dettaglio tutto ciò che vedi nell'immagine, inclusi testo, oggetti, persone, scene, colori e qualsiasi altro dettaglio rilevante. Rispondi sempre in italiano."},{role:"user",content:[{type:"text",text:t},{type:"image_url",image_url:{url:`data:${r};base64,${a}`,detail:"high"}}]}],max_tokens:2e3,temperature:.2})).choices[0].message.content}catch(e){if(console.error("Error in vision API:",e),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(400===e.status&&e.message?.includes("image"))throw Error("Formato immagine non supportato o immagine troppo grande.");throw Error(`Errore nell'analisi dell'immagine: ${e.message}`)}}async function d(r){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");let t=await e.A(323970),a=null;try{a=await E.files.create({file:t.createReadStream(r),purpose:"user_data"});let e=((await E.responses.create({model:"gpt-4o",input:[{role:"user",content:[{type:"input_text",text:"Estrai tutto il testo e le informazioni rilevanti da questo documento. Rispondi SOLO con il testo estratto, senza commenti."},{type:"input_file",file_id:a.id}]}],max_output_tokens:8e3,temperature:.1})).output_text||"").toString().trim();if(!e)throw Error("Nessun testo estratto dal PDF");return e}catch(e){if(console.error("Error in PDF text extraction (Responses API):",e),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(400===e.status)throw Error("Errore nell'analisi del PDF con Responses API. Il file potrebbe essere troppo grande o danneggiato.");throw Error(`Errore nell'estrazione del testo PDF: ${e.message}`)}finally{try{a&&a.id&&(E.files?.delete?await E.files.delete(a.id):E.files?.del&&await E.files.del(a.id))}catch(e){console.warn("Errore rimozione file da OpenAI (ignorato):",e?.message||e)}}}async function g(e,r={}){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let t=r.size||"1024x1024",a=r.quality||"standard",i=r.style||"vivid",o=await E.images.generate({model:"dall-e-3",prompt:e,size:t,quality:a,style:i,n:1}),n=o.data[0]?.url;if(!n)throw Error("Nessuna immagine generata da DALL-E");return n}catch(e){if(console.error("Error getting image URL from DALL-E:",e),console.error("Error details:",{status:e.status,statusText:e.statusText,message:e.message,code:e.code,response:e.response?.data||e.response}),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(400===e.status){let r=e.message||e.response?.data?.error?.message||"Prompt non valido o contenuto non consentito";throw Error(`Errore nella generazione: ${r}`)}else if("ENOTFOUND"===e.code||"ECONNREFUSED"===e.code)throw Error("Errore di connessione con OpenAI. Verifica la tua connessione internet.");throw Error(`Errore nella generazione dell'immagine: ${e.message||"Errore sconosciuto"}`)}}async function p(e,r={}){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let t=await g(e,r),a=await fetch(t);if(!a.ok){let e=await a.text().catch(()=>"Unknown error");throw Error(`Errore nel download dell'immagine generata: ${a.status} ${a.statusText}. ${e}`)}let i=await a.arrayBuffer();return Buffer.from(i)}catch(e){throw e}}async function h(e,r,t=null){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let a=await u(e,r,t||"Descrivi in dettaglio questa immagine, includendo tutti i dettagli visivi, colori, composizione, stile e qualità. La descrizione sarà usata per creare una versione migliorata ad alta risoluzione."),i=`Crea una versione migliorata e ad alta risoluzione di questa immagine: ${a}. Mantieni fedelt\xe0 ai dettagli originali ma migliora la qualit\xe0, la nitidezza e la risoluzione.`;return await p(i,{size:"1792x1024",quality:"hd",style:"natural"})}catch(e){throw console.error("Error upscaling image with DALL-E:",e),Error(`Errore nel miglioramento dell'immagine: ${e.message}`)}}async function f(r,t){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let a=`Analyze this image and identify specific quality issues that need improvement. Focus on:
1. Noise level (low/medium/high)
2. Sharpness (blurry/sharp)
3. Color accuracy (washed out/vibrant)
4. Artifacts (compression artifacts, pixelation)
5. Overall quality issues

Respond with a JSON object: {"noise": "low|medium|high", "sharpness": "blurry|moderate|sharp", "color": "washed|normal|vibrant", "artifacts": "none|minor|major", "recommendations": "brief description"}`,i=await u(r,t,a),o={noise:"medium",sharpness:"moderate",color:"normal",artifacts:"none"};try{let e=i.match(/\{[\s\S]*\}/);if(e){let r=JSON.parse(e[0]);o={...o,...r}}}catch(e){console.warn("Could not parse AI analysis, using defaults")}let n=(0,(await e.A(752039)).default)(r,{sequentialRead:!0});return("high"===o.noise||"medium"===o.noise)&&(n=n.median("high"===o.noise?3:2)),"blurry"===o.sharpness?n=n.sharpen({sigma:2,m1:1,m2:.5,x1:3,y2:3,y3:3}):"moderate"===o.sharpness&&(n=n.sharpen({sigma:1,m1:.7,m2:.4})),"washed"===o.color&&(n=n.modulate({saturation:1.15,brightness:1.05}).linear(1.05,-6.4)),n="major"===o.artifacts||"minor"===o.artifacts?n.png({quality:100,compressionLevel:6,adaptiveFiltering:!0}):"image/jpeg"===t||"image/jpg"===t?n.jpeg({quality:98,mozjpeg:!0,trellisQuantisation:!0,overshootDeringing:!0}):n.png({quality:100,compressionLevel:6}),await n.toBuffer()}catch(e){return console.error("Error enhancing image quality with AI:",e),r}}e.s(["analyzeImageWithVision",()=>u,"chatCompletion",()=>s,"classifyDocument",()=>m,"enhanceImageQualityWithAI",()=>f,"extractTextFromPdfWithOpenAI",()=>d,"generateEmbedding",()=>o,"generateEmbeddingsBatch",()=>n,"generateImageWithDALLE",()=>p,"generateSummary",()=>l,"generateTags",()=>c,"getImageUrlFromDALLE",()=>g,"upscaleImageWithDALLE",()=>h]),t()}catch(e){t(e)}},!1),323970,e=>{e.v(e=>Promise.resolve().then(()=>e(522734)))},752039,e=>{e.v(e=>Promise.resolve().then(()=>e(871815)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c54a6084._.js.map