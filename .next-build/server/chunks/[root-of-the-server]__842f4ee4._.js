module.exports=[14747,(e,t,a)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},22734,(e,t,a)=>{t.exports=e.x("fs",()=>require("fs"))},93635,e=>e.a(async(t,a)=>{try{let t=await e.y("formidable");e.n(t),a()}catch(e){a(e)}},!0),94543,(e,t,a)=>{t.exports=e.x("pdfkit",()=>require("pdfkit"))},77390,e=>e.a(async(t,a)=>{try{let t=await e.y("pdf-parse");e.n(t),a()}catch(e){a(e)}},!0),29211,(e,t,a)=>{t.exports=e.x("mammoth",()=>require("mammoth"))},34754,e=>e.a(async(t,a)=>{try{var r=e.i(93635),n=e.i(22734),i=e.i(14747),o=e.i(77390),l=e.i(29211),s=e.i(94543),d=t([r,o]);async function u(e,t,a){let r=i.default.extname(a).toLowerCase();if("application/pdf"===t||".pdf"===r){let t=n.default.readFileSync(e);return(await (0,o.default)(t)).text}if("application/vnd.openxmlformats-officedocument.wordprocessingml.document"===t||".docx"===r)return(await l.default.extractRawText({path:e})).value;if("application/msword"===t||".doc"===r)throw Error("I file .doc non sono supportati. Converti in .docx o .pdf");if("text/plain"===t||".txt"===r)return n.default.readFileSync(e,"utf-8");if("text/markdown"===t||".md"===r)return n.default.readFileSync(e,"utf-8");else throw Error("Formato file non supportato")}async function c(e,t,a){return`[TRADOTTO IN ${t.toUpperCase()}]

${e}`}async function p(e,t,a,r,o){let l=i.default.extname(r).toLowerCase();if(".pdf"===l){let e=new s.default,r=i.default.join(i.default.dirname(a),`translated_${Date.now()}.pdf`),o=n.default.createWriteStream(r);return e.pipe(o),e.fontSize(12),t.split("\n\n").forEach((t,a)=>{a>0&&e.moveDown(),e.text(t,{align:"left",continued:!1})}),e.end(),await new Promise((e,t)=>{o.on("finish",e),o.on("error",t)}),n.default.readFileSync(r)}if(".docx"===l){let e=i.default.join(i.default.dirname(a),`translated_${Date.now()}.txt`);return n.default.writeFileSync(e,t,"utf-8"),n.default.readFileSync(e)}{let e=i.default.join(i.default.dirname(a),`translated_${Date.now()}${l}`);return n.default.writeFileSync(e,t,"utf-8"),n.default.readFileSync(e)}}async function f(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let a=i.default.join(process.cwd(),"uploads");n.default.existsSync(a)||n.default.mkdirSync(a,{recursive:!0});let o=(0,r.default)({uploadDir:a,keepExtensions:!0,maxFileSize:0x3200000});try{let[r,l]=await new Promise((t,a)=>{o.parse(e,(e,r,n)=>{e?a(e):t([r,n])})}),s=Array.isArray(l.document)?l.document[0]:l.document,d=Array.isArray(r.targetLanguage)?r.targetLanguage[0]:r.targetLanguage||"en",f=Array.isArray(r.preserveFormatting)?"true"===r.preserveFormatting[0]:"true"===r.preserveFormatting;if(!s)return t.status(400).json({error:"Nessun documento caricato"});let m=await u(s.filepath,s.mimetype,s.originalFilename);if(!m||0===m.trim().length)return t.status(400).json({error:"Impossibile estrarre testo dal documento"});let y=await c(m,d,f),x=await p(m,y,s.filepath,s.originalFilename,d),h=i.default.extname(s.originalFilename).toLowerCase(),w="application/octet-stream",g=`translated_${d}_${s.originalFilename}`;".pdf"===h?w="application/pdf":".docx"===h?w="application/vnd.openxmlformats-officedocument.wordprocessingml.document":".txt"===h?w="text/plain":".md"===h&&(w="text/markdown");try{n.default.unlinkSync(s.filepath),n.default.readdirSync(a).filter(e=>e.startsWith("translated_")).forEach(e=>{try{n.default.unlinkSync(i.default.join(a,e))}catch(e){}})}catch(e){console.error("Errore cleanup:",e)}t.setHeader("Content-Type",w),t.setHeader("Content-Disposition",`attachment; filename=${g}`),t.status(200).send(x)}catch(e){console.error("Errore API Traduzione Documenti:",e),t.status(500).json({error:e.message||"Errore durante la traduzione del documento. Riprova con un file diverso."})}}[r,o]=d.then?(await d)():d,e.s(["config",0,{api:{bodyParser:!1}},"default",()=>f]),a()}catch(e){a(e)}},!1),16881,e=>e.a(async(t,a)=>{try{var r=e.i(26747),n=e.i(90406),i=e.i(44898),o=e.i(62950),l=e.i(34754),s=e.i(7031),d=e.i(81927),u=e.i(46432),c=t([l]);[l]=c.then?(await c)():c;let f=(0,o.hoist)(l,"default"),m=(0,o.hoist)(l,"config"),y=new i.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/tools/translate-document",pathname:"/api/tools/translate-document",bundlePath:"",filename:""},userland:l,distDir:".next-build",relativeProjectDir:""});async function p(e,t,a){y.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/tools/translate-document";n=n.replace(/\/index$/,"")||"/";let i=await y.prepare(e,t,{srcPage:n});if(!i){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:o,params:l,prerenderManifest:c,routerServerContext:p}=i;try{let a=e.method||"GET",r=(0,s.getTracer)(),i=r.getActiveScopeSpan(),u=y.instrumentationOnRequestError.bind(y),f=async i=>y.render(e,t,{query:{...o,...l},params:l,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:c.preview,propagateError:!1,dev:y.isDev,page:"/api/tools/translate-document",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${a} ${o}`;i.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),i.updateName(e)}else i.updateName(`${a} ${n}`)});i?await f(i):await r.withPropagatedContext(e.headers,()=>r.trace(d.BaseServerSpan.handleRequest,{spanName:`${a} ${n}`,kind:s.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},f))}catch(e){if(y.isDev)throw e;(0,r.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,m,"default",0,f,"handler",()=>p]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__842f4ee4._.js.map