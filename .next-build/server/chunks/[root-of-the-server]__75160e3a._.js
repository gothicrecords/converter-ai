module.exports=[24868,(e,t,r)=>{t.exports=e.x("fs/promises",()=>require("fs/promises"))},12181,(e,t,r)=>{t.exports=e.x("winston",()=>require("winston"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},28112,e=>{"use strict";var t=e.i(12181),r=e.i(14747);let s=(0,e.i(92509).fileURLToPath)({get url(){return`file://${e.P("lib/logger.js")}`}}.url);r.default.dirname(s);let a=t.default.format.combine(t.default.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),t.default.format.errors({stack:!0}),t.default.format.splat(),t.default.format.json());t.default.format.combine(t.default.format.colorize(),t.default.format.timestamp({format:"HH:mm:ss"}),t.default.format.printf(({timestamp:e,level:t,message:r,...s})=>{let a=`${e} [${t}]: ${r}`;return Object.keys(s).length>0&&s.stack?a+=`
${s.stack}`:Object.keys(s).length>0&&(a+=`
${JSON.stringify(s,null,2)}`),a}));let i=r.default.join(process.cwd(),"logs"),o=t.default.createLogger({level:process.env.LOG_LEVEL||"info",format:a,defaultMeta:{service:"upscaler-ai",environment:"production"},transports:[new t.default.transports.Console({format:t.default.format.json(),handleExceptions:!0,handleRejections:!0}),new t.default.transports.File({filename:r.default.join(i,"error.log"),level:"error",maxsize:5242880,maxFiles:5,format:a}),new t.default.transports.File({filename:r.default.join(i,"combined.log"),maxsize:5242880,maxFiles:5,format:a})],exceptionHandlers:[new t.default.transports.File({filename:r.default.join(i,"exceptions.log"),maxsize:5242880,maxFiles:3})],rejectionHandlers:[new t.default.transports.File({filename:r.default.join(i,"rejections.log"),maxsize:5242880,maxFiles:3})]});e.s(["default",0,o,"log",0,{error:(e,t=null,r={})=>{let s={message:e,...r};return t&&(s.error={name:t.name,message:t.message,stack:t.stack,code:t.code,statusCode:t.statusCode,details:t.details}),o.error(e,s),s},warn:(e,t={})=>{o.warn(e,t)},info:(e,t={})=>{o.info(e,t)},debug:(e,t={})=>{},api:(e,t,r=null)=>{let s={method:e.method,url:e.url,path:e.path,statusCode:t.statusCode,userAgent:e.headers["user-agent"],ip:e.ip||e.connection.remoteAddress};r&&(s.responseTime=`${r}ms`),t.statusCode>=400?o.warn("API Request",s):o.info("API Request",s)},database:(e,t=null,r=null,s=null)=>{let a={operation:e,duration:r?`${r}ms`:null};t&&(a.query="string"==typeof t?t:JSON.stringify(t)),s?o.error("Database Operation Failed",{...a,error:s}):o.debug("Database Operation",a)},file:(e,t,r=null,s=null)=>{let a={operation:e,filePath:t,size:r?`${(r/1024).toFixed(2)}KB`:null};s?o.error("File Operation Failed",{...a,error:s}):o.debug("File Operation",a)},performance:(e,t,r={})=>{o.info("Performance Metric",{operation:e,duration:`${t}ms`,...r})}}])},45255,e=>{"use strict";var t=e.i(28112),r=e.i(24868),s=e.i(14747);let a=(0,e.i(92509).fileURLToPath)({get url(){return`file://${e.P("lib/errorTracker.js")}`}}.url);s.default.dirname(a);let i=s.default.join(process.cwd(),"logs","errors.db.json"),o={ECONNREFUSED:{type:"database",severity:"high",solution:"Check database connection settings and ensure database is running",autoFix:!1},ETIMEDOUT:{type:"network",severity:"medium",solution:"Check network connectivity and timeout settings",autoFix:!1},ENOENT:{type:"filesystem",severity:"medium",solution:"File or directory not found. Check file paths and permissions",autoFix:!0},EACCES:{type:"permission",severity:"high",solution:"Permission denied. Check file/directory permissions",autoFix:!1},EMFILE:{type:"resource",severity:"high",solution:"Too many open files. Increase ulimit or close file handles",autoFix:!1},LIMIT_FILE_SIZE:{type:"validation",severity:"low",solution:"File size exceeds limit. Check file size validation",autoFix:!1},VALIDATION_ERROR:{type:"validation",severity:"low",solution:"Input validation failed. Check input data format",autoFix:!1},AUTHENTICATION_ERROR:{type:"auth",severity:"medium",solution:"Authentication required. Check user session and tokens",autoFix:!1}},n=new class{constructor(){this.errorCounts=new Map,this.errorHistory=[],this.maxHistorySize=1e3}async trackError(e,r={}){let s={id:this.generateErrorId(),timestamp:new Date().toISOString(),error:{name:e.name,message:e.message,code:e.code,stack:e.stack,statusCode:e.statusCode},context:{...r,environment:"production",nodeVersion:process.version},pattern:this.analyzeErrorPattern(e),frequency:1},a=this.getErrorKey(e),i=this.errorCounts.get(a)||0;return this.errorCounts.set(a,i+1),s.frequency=i+1,this.errorHistory.push(s),this.errorHistory.length>this.maxHistorySize&&this.errorHistory.shift(),t.log.error("Error Tracked",e,{errorId:s.id,pattern:s.pattern,frequency:s.frequency,...r}),await this.saveErrorToDB(s),this.shouldAlert(s)&&await this.sendAlert(s),s}analyzeErrorPattern(e){let t={type:"unknown",severity:"low",solution:null,autoFixable:!1,similarErrors:[]};if(e.code&&o[e.code]){let r=o[e.code];t.type=r.type,t.severity=r.severity,t.solution=r.solution,t.autoFixable=r.autoFix}if(e.message){let r=e.message.toLowerCase();r.includes("timeout")?(t.type="timeout",t.severity="medium",t.solution="Operation timed out. Consider increasing timeout or optimizing operation"):r.includes("memory")?(t.type="memory",t.severity="high",t.solution="Memory issue detected. Check memory usage and optimize"):(r.includes("permission")||r.includes("access"))&&(t.type="permission",t.severity="high",t.solution="Permission issue. Check file/directory permissions")}return t.similarErrors=this.findSimilarErrors(e),t}findSimilarErrors(e,t=5){return this.errorHistory.filter(t=>t.error.name===e.name||t.error.message&&e.message&&this.similarity(t.error.message,e.message)>.7).slice(-t).map(e=>({id:e.id,timestamp:e.timestamp,message:e.error.message}))}similarity(e,t){let r=new Set(e.toLowerCase().split(/\s+/)),s=new Set(t.toLowerCase().split(/\s+/)),a=new Set([...r].filter(e=>s.has(e))),i=new Set([...r,...s]);return a.size/i.size}generateErrorId(){return`ERR-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getErrorKey(e){return`${e.name||"Error"}:${e.code||"NO_CODE"}:${e.message?.substring(0,50)||"NO_MESSAGE"}`}shouldAlert(e){return"high"===e.pattern.severity||e.frequency>10||this.errorHistory.filter(t=>t.error.name===e.error.name&&new Date(t.timestamp)>new Date(Date.now()-3e5)).length>5}async sendAlert(e){if(t.log.warn("Error Alert Triggered",{errorId:e.id,severity:e.pattern.severity,frequency:e.frequency,solution:e.pattern.solution}),process.env.ERROR_ALERT_WEBHOOK)try{await fetch(process.env.ERROR_ALERT_WEBHOOK,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({error:e.error,pattern:e.pattern,frequency:e.frequency,timestamp:e.timestamp})})}catch(e){t.log.error("Failed to send error alert",e)}}async saveErrorToDB(e){try{let t=s.default.dirname(i);await r.default.mkdir(t,{recursive:!0});let a=[];try{let e=await r.default.readFile(i,"utf-8");a=JSON.parse(e)}catch(e){}a.push(e),a.length>1e4&&(a=a.slice(-1e4)),await r.default.writeFile(i,JSON.stringify(a,null,2))}catch(e){t.log.error("Failed to save error to DB",e)}}getStats(){let e={totalErrors:this.errorHistory.length,uniqueErrors:this.errorCounts.size,errorsByType:{},errorsBySeverity:{},recentErrors:this.errorHistory.slice(-10),topErrors:Array.from(this.errorCounts.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e,t])=>({error:e,count:t}))};return this.errorHistory.forEach(t=>{let r=t.pattern.type;e.errorsByType[r]=(e.errorsByType[r]||0)+1}),this.errorHistory.forEach(t=>{let r=t.pattern.severity;e.errorsBySeverity[r]=(e.errorsBySeverity[r]||0)+1}),e}getErrorsByPattern(e){return this.errorHistory.filter(t=>t.pattern.type===e)}clearHistory(){this.errorHistory=[],this.errorCounts.clear()}};e.s(["default",0,n])},10479,e=>{"use strict";var t=e.i(28112),r=e.i(45255),s=e.i(24868),a=e.i(14747),i=e.i(92509),o=e.i(46786);let n=(0,i.fileURLToPath)({get url(){return`file://${e.P("lib/diagnostics.js")}`}}.url);a.default.dirname(n);let l=new class{constructor(){this.checks=new Map,this.healthStatus={overall:"unknown",checks:{},timestamp:null,system:{}}}registerCheck(e,t,r={}){this.checks.set(e,{fn:t,critical:!1!==r.critical,interval:r.interval||6e4,timeout:r.timeout||5e3,lastRun:null,lastResult:null})}async runAllChecks(){let e={},r=Date.now();for(let[r,s]of(e.system=await this.getSystemInfo(),this.checks.entries()))try{let t=await this.runCheck(r,s);e[r]=t}catch(s){t.log.error(`Health check failed: ${r}`,s),e[r]={status:"error",message:s.message,error:s.name}}let s=Array.from(this.checks.entries()).filter(([e,t])=>t.critical).map(([e])=>e).some(t=>e[t]?.status==="error"||e[t]?.status==="unhealthy")?"unhealthy":Object.values(e).some(e=>e?.status==="warning")?"degraded":"healthy";return this.healthStatus={overall:s,checks:e,timestamp:new Date().toISOString(),system:e.system,duration:Date.now()-r},this.healthStatus}async runCheck(e,t){let r=Date.now();try{let e=await Promise.race([t.fn(),new Promise((e,r)=>setTimeout(()=>r(Error("Check timeout")),t.timeout))]),s=Date.now()-r;return t.lastRun=new Date,t.lastResult=e,{status:e.status||"healthy",message:e.message,data:e.data,duration:`${s}ms`,timestamp:t.lastRun.toISOString()}}catch(e){return t.lastRun=new Date,t.lastResult={status:"error",error:e.message},{status:"error",message:e.message,duration:`${Date.now()-r}ms`,timestamp:t.lastRun.toISOString()}}}async getSystemInfo(){let e=o.default.cpus(),t=o.default.totalmem(),r=o.default.freemem(),s=t-r;return{platform:o.default.platform(),arch:o.default.arch(),nodeVersion:process.version,uptime:`${Math.floor(o.default.uptime()/3600)}h ${Math.floor(o.default.uptime()%3600/60)}m`,cpu:{model:e[0]?.model||"Unknown",cores:e.length,usage:process.cpuUsage()},memory:{total:`${(t/1024/1024/1024).toFixed(2)}GB`,free:`${(r/1024/1024/1024).toFixed(2)}GB`,used:`${(s/1024/1024/1024).toFixed(2)}GB`,usagePercent:`${(s/t*100).toFixed(2)}%`},loadAverage:o.default.loadavg(),environment:"production"}}async checkDatabase(){try{let{createClient:t}=await e.A(31636),r=t("https://ckctyvebrkcemcgllpbc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrY3R5dmVicWtjZW1jZ2xscGJjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNDYzMzksImV4cCI6MjA3ODkyMjMzOX0.kGyjcR9D8vLD5xYsEvHA5qAQ08OvoOC4mgajSmnh0jM"),{error:s}=await r.from("_health_check").select("1").limit(1);if(s&&"PGRST116"!==s.code)return{status:"unhealthy",message:`Database connection failed: ${s.message}`};return{status:"healthy",message:"Database connection successful"}}catch(e){return{status:"error",message:`Database check failed: ${e.message}`}}}async checkFileSystem(){try{let e=a.default.join(process.cwd(),"uploads"),t=a.default.join(process.cwd(),"logs"),r=a.default.join(process.cwd(),"tmp"),i={};for(let o of[e,t,r])try{await s.default.access(o);let e=await s.default.stat(o);i[a.default.basename(o)]={exists:!0,writable:!0,isDirectory:e.isDirectory()}}catch(e){if("ENOENT"===e.code)try{await s.default.mkdir(o,{recursive:!0}),i[a.default.basename(o)]={exists:!0,writable:!0,created:!0}}catch(e){i[a.default.basename(o)]={exists:!1,writable:!1,error:e.message}}else i[a.default.basename(o)]={exists:!1,writable:!1,error:e.message}}let o=Object.values(i).some(e=>!e.exists||!e.writable);return{status:o?"warning":"healthy",message:o?"Some directories have issues":"File system healthy",data:i}}catch(e){return{status:"error",message:`File system check failed: ${e.message}`}}}async checkEnvironment(){let e=["NODE_ENV"],t=["NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","CLOUDINARY_CLOUD_NAME","CLOUDINARY_API_KEY","STRIPE_SECRET_KEY","HF_API_TOKEN"],r=e.filter(e=>!process.env[e]),s=t.filter(e=>process.env[e]);return{status:r.length>0?"warning":"healthy",message:r.length>0?`Missing required environment variables: ${r.join(", ")}`:"Environment variables configured",data:{required:{total:e.length,configured:e.length-r.length,missing:r},optional:{total:t.length,configured:s.length,configuredKeys:s}}}}async checkErrors(){try{let e=r.default.getStats(),t=e.recentErrors.filter(e=>{let t=new Date(e.timestamp),r=new Date(Date.now()-3e5);return t>r}),s=e.recentErrors.filter(e=>e.pattern?.severity==="high"),a="healthy",i="No recent errors";return s.length>0?(a="unhealthy",i=`${s.length} high severity errors in last 5 minutes`):t.length>10&&(a="warning",i=`${t.length} errors in last 5 minutes`),{status:a,message:i,data:{totalErrors:e.totalErrors,uniqueErrors:e.uniqueErrors,recentErrors:t.length,highSeverityErrors:s.length,topErrors:e.topErrors.slice(0,5)}}}catch(e){return{status:"error",message:`Error check failed: ${e.message}`}}}async checkDiskSpace(){try{let e=a.default.join(process.cwd(),"tmp",".health-check");try{return await s.default.writeFile(e,"test"),await s.default.unlink(e),{status:"healthy",message:"Disk space available"}}catch(e){return{status:"warning",message:`Disk write test failed: ${e.message}`}}}catch(e){return{status:"error",message:`Disk space check failed: ${e.message}`}}}async getFullDiagnostics(){return{timestamp:new Date().toISOString(),health:await this.runAllChecks(),errorStats:r.default.getStats(),recommendations:await this.getRecommendations()}}async getRecommendations(){let e=[],t=this.healthStatus;if(t.system?.memory){let r=parseFloat(t.system.memory.usagePercent);r>90?e.push({type:"memory",severity:"high",message:"Memory usage is very high. Consider optimizing memory usage or scaling up.",action:"Review memory-intensive operations and consider caching strategies"}):r>75&&e.push({type:"memory",severity:"medium",message:"Memory usage is elevated. Monitor closely.",action:"Review memory usage patterns"})}r.default.getStats().recentErrors.length>20&&e.push({type:"errors",severity:"high",message:"High error rate detected. Immediate attention required.",action:"Review error logs and fix critical issues"});let s=t.checks?.fileSystem;(s?.status==="warning"||s?.status==="error")&&e.push({type:"filesystem",severity:"medium",message:"File system issues detected",action:"Check directory permissions and disk space"});let a=t.checks?.database;return(a?.status==="unhealthy"||a?.status==="error")&&e.push({type:"database",severity:"high",message:"Database connectivity issues",action:"Check database connection settings and ensure database is running"}),e}initializeDefaultChecks(){this.registerCheck("database",()=>this.checkDatabase(),{critical:!0}),this.registerCheck("fileSystem",()=>this.checkFileSystem(),{critical:!0}),this.registerCheck("environment",()=>this.checkEnvironment(),{critical:!1}),this.registerCheck("errors",()=>this.checkErrors(),{critical:!1}),this.registerCheck("diskSpace",()=>this.checkDiskSpace(),{critical:!1})}};l.initializeDefaultChecks(),e.s(["default",0,l])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__75160e3a._.js.map