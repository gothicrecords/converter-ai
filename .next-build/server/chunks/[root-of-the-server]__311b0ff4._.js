module.exports=[270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},293635,e=>e.a(async(t,r)=>{try{let t=await e.y("formidable");e.n(t),r()}catch(e){r(e)}},!0),515954,e=>{"use strict";class t extends Error{constructor(e,t=500,r=null,a=null,i=null){super(e),this.name=this.constructor.name,this.statusCode=t,this.code=r,this.details=a,this.originalError=i,this.timestamp=new Date().toISOString(),this.requestId=null,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack}toJSON(){return{name:this.name,message:this.message,statusCode:this.statusCode,code:this.code,details:this.details,timestamp:this.timestamp,requestId:this.requestId,stack:this.stack}}}class r extends t{constructor(e,t=null){super(e,400,"VALIDATION_ERROR",t)}}class a extends t{constructor(e="Authentication required"){super(e,401,"AUTHENTICATION_ERROR")}}class i extends t{constructor(e){super(e,409,"CONFLICT")}}class o extends t{constructor(e,t=null){super(e,500,"FILE_SYSTEM_ERROR",null,t)}}class n extends t{constructor(e,t=null){super(e,503,"NETWORK_ERROR",null,t)}}class s extends t{constructor(e="Request timeout",t=null){super(e,408,"TIMEOUT_ERROR",t?{timeoutMs:t}:null)}}class l extends t{constructor(e,t=null){super(`File too large. Maximum size is ${function(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}(e)}`,413,"FILE_TOO_LARGE",{maxSize:e,actualSize:t})}}class m extends t{constructor(e=null){super(e?`Invalid file type. Allowed types: ${e.join(", ")}`:"Invalid file type",400,"INVALID_FILE_TYPE",{allowedTypes:e})}}class c extends t{constructor(e,t=null){super(e,500,"PROCESSING_ERROR",null,t)}}async function u(r,a={}){let i={timestamp:new Date().toISOString(),error:r instanceof t?r.toJSON():{name:r.name,message:r.message,stack:r.stack},context:a,environment:"production"};r instanceof t&&r.statusCode<500?console.warn("Client Error:",JSON.stringify(i,null,2)):console.error("Server Error:",JSON.stringify(i,null,2));try{let{default:t}=await e.A(139867),{log:i}=await e.A(970795);await t.trackError(r,a),i.error("Error logged",r,a)}catch(e){console.warn("Error tracker not available:",e.message)}return process.env.ERROR_TRACKING_ENABLED,i}function d(e,t=!1,r=!0){let a={error:e.message||"Internal server error",code:e.code||"INTERNAL_ERROR"};return r&&e.details&&(a.details=e.details),(t||0)&&(a.stack=e.stack),e.requestId&&(a.requestId=e.requestId),e.timestamp&&(a.timestamp=e.timestamp),a}async function h(e,a,i={}){return(await u(e,i),a.headersSent)?void 0:e instanceof t?a.status(e.statusCode).json(d(e,!1,!0)):"ValidationError"===e.name||"CastError"===e.name?a.status(400).json(d(new r(e.message,e.errors),!1)):"ECONNREFUSED"===e.code||"ETIMEDOUT"===e.code?a.status(503).json(d(new n("Database connection failed",e),!1)):"ENOENT"===e.code||"EACCES"===e.code||"EMFILE"===e.code?a.status(500).json(d(new o("File system operation failed",e),!1)):e.message&&(e.message.includes("timeout")||e.message.includes("ETIMEDOUT"))?a.status(408).json(d(new s("Request timeout",e.timeout),!1)):"LIMIT_FILE_SIZE"===e.code||e.message?.includes("too large")?a.status(413).json(d(new l,!1)):void a.status(500).json(d(new t("Internal server error",500,"INTERNAL_ERROR",null,e),!1))}e.s(["AuthenticationError",()=>a,"ConflictError",()=>i,"FileSystemError",()=>o,"FileTooLargeError",()=>l,"InvalidFileTypeError",()=>m,"ProcessingError",()=>c,"TimeoutError",()=>s,"ValidationError",()=>r,"handleApiError",()=>h])},871815,(e,t,r)=>{t.exports=e.x("sharp",()=>require("sharp"))},74538,e=>e.a(async(t,r)=>{try{let t=await e.y("openai");e.n(t),r()}catch(e){r(e)}},!0),267370,e=>e.a(async(t,r)=>{try{var a=e.i(74538),i=t([a]);[a]=i.then?(await i)():i;let f=new a.default({apiKey:process.env.OPENAI_API_KEY});async function o(e){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{return(await f.embeddings.create({model:"text-embedding-3-small",input:e.substring(0,8e3)})).data[0].embedding}catch(e){throw console.error("Error generating embedding:",e),Error(`Failed to generate embedding: ${e.message}`)}}async function n(e){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");if(!Array.isArray(e)||0===e.length)return[];try{return(await f.embeddings.create({model:"text-embedding-3-small",input:e.map(e=>(e||"").toString().substring(0,8e3))})).data.map(e=>e.embedding)}catch(e){throw console.error("Error generating batch embeddings:",e),Error(`Failed to generate batch embeddings: ${e.message}`)}}async function s(e,t={}){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{return(await f.chat.completions.create({model:t.model||"gpt-4o-mini",messages:e,temperature:t.temperature||.7,max_tokens:t.max_tokens||1e3,top_p:t.top_p||1,frequency_penalty:t.frequency_penalty||0,presence_penalty:t.presence_penalty||0})).choices[0].message.content}catch(e){if(console.error("Error in chat completion:",e),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(500===e.status)throw Error("Errore del server OpenAI. Riprova più tardi.");throw Error(`Errore nella comunicazione con OpenAI: ${e.message}`)}}async function l(e,t=200){let r=[{role:"system",content:"You are a helpful assistant that creates concise summaries."},{role:"user",content:`Summarize the following text in ${t} words or less:

${e}`}];return await s(r,{temperature:.5,max_tokens:300})}async function m(e,t=5){let r=[{role:"system",content:"You are a helpful assistant that generates relevant tags for documents. Return only comma-separated tags, no explanations."},{role:"user",content:`Generate ${t} relevant tags for this document:

${e.substring(0,2e3)}`}];return(await s(r,{temperature:.3,max_tokens:100})).split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0).slice(0,t)}async function c(e){let t=["contract","invoice","report","presentation","spreadsheet","image","code","email","article","other"],r=[{role:"system",content:`You are a document classifier. Classify the document into one or more of these categories: ${t.join(", ")}. Return only category names, comma-separated.`},{role:"user",content:`Classify this document:

${e.substring(0,1e3)}`}];return(await s(r,{temperature:.2,max_tokens:50})).split(",").map(e=>e.trim().toLowerCase()).filter(e=>t.includes(e))}async function u(e,t,r="Cosa contiene questa immagine? Descrivi tutto ciò che vedi."){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let a=e.toString("base64");return(await f.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"Sei un assistente AI esperto nell'analisi di immagini. Descrivi in dettaglio tutto ciò che vedi nell'immagine, inclusi testo, oggetti, persone, scene, colori e qualsiasi altro dettaglio rilevante. Rispondi sempre in italiano."},{role:"user",content:[{type:"text",text:r},{type:"image_url",image_url:{url:`data:${t};base64,${a}`,detail:"high"}}]}],max_tokens:2e3,temperature:.2})).choices[0].message.content}catch(e){if(console.error("Error in vision API:",e),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(400===e.status&&e.message?.includes("image"))throw Error("Formato immagine non supportato o immagine troppo grande.");throw Error(`Errore nell'analisi dell'immagine: ${e.message}`)}}async function d(t){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");let r=await e.A(323970),a=null;try{a=await f.files.create({file:r.createReadStream(t),purpose:"user_data"});let e=((await f.responses.create({model:"gpt-4o",input:[{role:"user",content:[{type:"input_text",text:"Estrai tutto il testo e le informazioni rilevanti da questo documento. Rispondi SOLO con il testo estratto, senza commenti."},{type:"input_file",file_id:a.id}]}],max_output_tokens:8e3,temperature:.1})).output_text||"").toString().trim();if(!e)throw Error("Nessun testo estratto dal PDF");return e}catch(e){if(console.error("Error in PDF text extraction (Responses API):",e),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(400===e.status)throw Error("Errore nell'analisi del PDF con Responses API. Il file potrebbe essere troppo grande o danneggiato.");throw Error(`Errore nell'estrazione del testo PDF: ${e.message}`)}finally{try{a&&a.id&&(f.files?.delete?await f.files.delete(a.id):f.files?.del&&await f.files.del(a.id))}catch(e){console.warn("Errore rimozione file da OpenAI (ignorato):",e?.message||e)}}}async function h(e,t={}){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let r=t.size||"1024x1024",a=t.quality||"standard",i=t.style||"vivid",o=await f.images.generate({model:"dall-e-3",prompt:e,size:r,quality:a,style:i,n:1}),n=o.data[0]?.url;if(!n)throw Error("Nessuna immagine generata da DALL-E");return n}catch(e){if(console.error("Error getting image URL from DALL-E:",e),console.error("Error details:",{status:e.status,statusText:e.statusText,message:e.message,code:e.code,response:e.response?.data||e.response}),401===e.status)throw Error("Chiave API OpenAI non valida. Verifica la configurazione.");if(429===e.status)throw Error("Limite di rate raggiunto. Riprova tra qualche secondo.");if(400===e.status){let t=e.message||e.response?.data?.error?.message||"Prompt non valido o contenuto non consentito";throw Error(`Errore nella generazione: ${t}`)}else if("ENOTFOUND"===e.code||"ECONNREFUSED"===e.code)throw Error("Errore di connessione con OpenAI. Verifica la tua connessione internet.");throw Error(`Errore nella generazione dell'immagine: ${e.message||"Errore sconosciuto"}`)}}async function g(e,t={}){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let r=await h(e,t),a=await fetch(r);if(!a.ok){let e=await a.text().catch(()=>"Unknown error");throw Error(`Errore nel download dell'immagine generata: ${a.status} ${a.statusText}. ${e}`)}let i=await a.arrayBuffer();return Buffer.from(i)}catch(e){throw e}}async function y(e,t,r=null){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let a=await u(e,t,r||"Descrivi in dettaglio questa immagine, includendo tutti i dettagli visivi, colori, composizione, stile e qualità. La descrizione sarà usata per creare una versione migliorata ad alta risoluzione."),i=`Crea una versione migliorata e ad alta risoluzione di questa immagine: ${a}. Mantieni fedelt\xe0 ai dettagli originali ma migliora la qualit\xe0, la nitidezza e la risoluzione.`;return await g(i,{size:"1792x1024",quality:"hd",style:"natural"})}catch(e){throw console.error("Error upscaling image with DALL-E:",e),Error(`Errore nel miglioramento dell'immagine: ${e.message}`)}}async function p(t,r){if(!process.env.OPENAI_API_KEY)throw Error("OPENAI_API_KEY is not configured. Please set it in your environment variables.");try{let a=`Analyze this image and identify specific quality issues that need improvement. Focus on:
1. Noise level (low/medium/high)
2. Sharpness (blurry/sharp)
3. Color accuracy (washed out/vibrant)
4. Artifacts (compression artifacts, pixelation)
5. Overall quality issues

Respond with a JSON object: {"noise": "low|medium|high", "sharpness": "blurry|moderate|sharp", "color": "washed|normal|vibrant", "artifacts": "none|minor|major", "recommendations": "brief description"}`,i=await u(t,r,a),o={noise:"medium",sharpness:"moderate",color:"normal",artifacts:"none"};try{let e=i.match(/\{[\s\S]*\}/);if(e){let t=JSON.parse(e[0]);o={...o,...t}}}catch(e){console.warn("Could not parse AI analysis, using defaults")}let n=(0,(await e.A(752039)).default)(t,{sequentialRead:!0});return("high"===o.noise||"medium"===o.noise)&&(n=n.median("high"===o.noise?3:2)),"blurry"===o.sharpness?n=n.sharpen({sigma:2,m1:1,m2:.5,x1:3,y2:3,y3:3}):"moderate"===o.sharpness&&(n=n.sharpen({sigma:1,m1:.7,m2:.4})),"washed"===o.color&&(n=n.modulate({saturation:1.15,brightness:1.05}).linear(1.05,-6.4)),n="major"===o.artifacts||"minor"===o.artifacts?n.png({quality:100,compressionLevel:6,adaptiveFiltering:!0}):"image/jpeg"===r||"image/jpg"===r?n.jpeg({quality:98,mozjpeg:!0,trellisQuantisation:!0,overshootDeringing:!0}):n.png({quality:100,compressionLevel:6}),await n.toBuffer()}catch(e){return console.error("Error enhancing image quality with AI:",e),t}}e.s(["analyzeImageWithVision",()=>u,"chatCompletion",()=>s,"classifyDocument",()=>c,"enhanceImageQualityWithAI",()=>p,"extractTextFromPdfWithOpenAI",()=>d,"generateEmbedding",()=>o,"generateEmbeddingsBatch",()=>n,"generateImageWithDALLE",()=>g,"generateSummary",()=>l,"generateTags",()=>m,"getImageUrlFromDALLE",()=>h,"upscaleImageWithDALLE",()=>y]),r()}catch(e){r(e)}},!1),924868,(e,t,r)=>{t.exports=e.x("fs/promises",()=>require("fs/promises"))},314613,e=>{"use strict";let t={GUEST:{"rimozione-sfondo-ai":{daily:5,monthly:50,fileSize:5242880},"generazione-immagini-ai":{daily:5,monthly:50},"clean-noise-ai":{daily:5,monthly:50,fileSize:0xa00000},"ocr-avanzato-ai":{daily:5,monthly:50,fileSize:0xa00000},"traduzione-documenti-ai":{daily:5,monthly:50,fileSize:0xa00000},"elabora-e-riassumi":{daily:5,monthly:50,maxLength:5e3},"thumbnail-generator":{daily:5,monthly:50},"upscaler-ai":{daily:5,monthly:50,fileSize:5242880},"trascrizione-audio":{daily:10,monthly:200,fileSize:0x1900000},"riassunto-testo":{daily:20,monthly:500,maxLength:1e4},"traduci-testo":{daily:50,monthly:1e3,maxLength:5e3},"correttore-grammaticale":{daily:30,monthly:500,maxLength:5e3},"combina-splitta-pdf":{daily:20,monthly:300,fileSize:0x3200000}},FREE:{"rimozione-sfondo-ai":{daily:50,monthly:1e3,fileSize:0xa00000},"generazione-immagini-ai":{daily:20,monthly:300},"clean-noise-ai":{daily:20,monthly:400,fileSize:0x1900000},"ocr-avanzato-ai":{daily:50,monthly:1e3,fileSize:0x1900000},"traduzione-documenti-ai":{daily:20,monthly:400,fileSize:0x1900000},"elabora-e-riassumi":{daily:50,monthly:1e3,maxLength:2e4},"thumbnail-generator":{daily:50,monthly:1e3},"upscaler-ai":{daily:100,monthly:2e3,fileSize:0x1900000},"trascrizione-audio":{daily:50,monthly:1e3,fileSize:0x3200000},"riassunto-testo":{daily:100,monthly:2e3,maxLength:5e4},"traduci-testo":{daily:200,monthly:5e3,maxLength:2e4},"correttore-grammaticale":{daily:100,monthly:2e3,maxLength:2e4},"combina-splitta-pdf":{daily:100,monthly:2e3,fileSize:0x6400000}},PRO:{"rimozione-sfondo-ai":{daily:-1,monthly:-1,fileSize:0x3200000},"generazione-immagini-ai":{daily:100,monthly:2e3},"clean-noise-ai":{daily:-1,monthly:-1,fileSize:0x6400000},"ocr-avanzato-ai":{daily:-1,monthly:-1,fileSize:0x6400000},"traduzione-documenti-ai":{daily:-1,monthly:-1,fileSize:0x6400000},"elabora-e-riassumi":{daily:-1,monthly:-1,maxLength:-1},"thumbnail-generator":{daily:-1,monthly:-1},"upscaler-ai":{daily:-1,monthly:-1,fileSize:0x6400000},"trascrizione-audio":{daily:-1,monthly:-1,fileSize:0xc800000},"riassunto-testo":{daily:-1,monthly:-1,maxLength:-1},"traduci-testo":{daily:-1,monthly:-1,maxLength:-1},"correttore-grammaticale":{daily:-1,monthly:-1,maxLength:-1},"combina-splitta-pdf":{daily:-1,monthly:-1,fileSize:524288e3}}};function r(e,a="GUEST"){return(t[a]||t.GUEST)[e]||null}function a(e,t="GUEST",i={},o={}){let n=r(e,t);if(!n)return{allowed:!0,reason:"Nessun limite configurato"};if(-1!==n.daily&&i.daily>=n.daily)return{allowed:!1,reason:`Hai raggiunto il limite giornaliero di ${n.daily} utilizzi. Riprova domani o passa a PRO per limiti pi\xf9 alti.`,limitType:"daily",current:i.daily,max:n.daily};if(-1!==n.monthly&&i.monthly>=n.monthly)return{allowed:!1,reason:`Hai raggiunto il limite mensile di ${n.monthly} utilizzi. Passa a PRO per limiti pi\xf9 alti.`,limitType:"monthly",current:i.monthly,max:n.monthly};if(n.fileSize&&o.size&&o.size>n.fileSize){let e=(n.fileSize/1048576).toFixed(0);return{allowed:!1,reason:`File troppo grande. Dimensione massima: ${e}MB. Passa a PRO per file pi\xf9 grandi.`,limitType:"fileSize",current:o.size,max:n.fileSize}}return n.maxLength&&o.length&&o.length>n.maxLength?{allowed:!1,reason:`Testo troppo lungo. Lunghezza massima: ${n.maxLength} caratteri. Passa a PRO per testi pi\xf9 lunghi.`,limitType:"maxLength",current:o.length,max:n.maxLength}:{allowed:!0,reason:"OK"}}function i(e,t="GUEST"){let a=r(e,t),o=r(e,"PRO");if(!a||!o)return"Passa a PRO per funzionalità avanzate!";let n=[];if(-1!==a.daily&&-1===o.daily?n.push("utilizzi illimitati"):a.daily<o.daily&&n.push(`${o.daily} utilizzi al giorno`),a.fileSize&&o.fileSize&&a.fileSize<o.fileSize){let e=(o.fileSize/1048576).toFixed(0);n.push(`file fino a ${e}MB`)}return(a.maxLength&&-1===o.maxLength&&n.push("testi di lunghezza illimitata"),0===n.length)?"Passa a PRO per funzionalità avanzate!":`Passa a PRO per ${n.join(", ")} e molto altro!`}e.s(["canUseTool",()=>a,"getUpgradeMessage",()=>i])},975111,e=>{"use strict";let t=new Map;function r(e="guest",a){let i=e||"guest";t.has(i)||t.set(i,{});let o=t.get(i);o[a]||(o[a]={daily:0,monthly:0,lastDailyReset:new Date().toDateString(),lastMonthlyReset:new Date().getMonth()});let n=o[a],s=new Date().toDateString(),l=new Date().getMonth();return n.lastDailyReset!==s&&(n.daily=0,n.lastDailyReset=s),n.lastMonthlyReset!==l&&(n.monthly=0,n.lastMonthlyReset=l),{daily:n.daily||0,monthly:n.monthly||0}}function a(e="guest",r){let i=e||"guest";t.has(i)||t.set(i,{});let o=t.get(i);o[r]||(o[r]={daily:0,monthly:0,lastDailyReset:new Date().toDateString(),lastMonthlyReset:new Date().getMonth()});let n=o[r],s=new Date().toDateString(),l=new Date().getMonth();n.lastDailyReset!==s&&(n.daily=0,n.lastDailyReset=s),n.lastMonthlyReset!==l&&(n.monthly=0,n.lastMonthlyReset=l),n.daily=(n.daily||0)+1,n.monthly=(n.monthly||0)+1}function i(e=null){return e&&e.headers&&e.headers["x-user-id"]?"FREE":"GUEST"}function o(e=null){return e&&e.headers&&e.headers["x-user-id"]?e.headers["x-user-id"]:"guest"}e.s(["getUsageStats",()=>r,"getUserId",()=>o,"getUserPlan",()=>i,"incrementUsage",()=>a])},323970,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_fs_54ffce70._.js"].map(t=>e.l(t))).then(()=>t(522734)))},752039,e=>{e.v(e=>Promise.resolve().then(()=>e(871815)))},139867,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__fecf867a._.js"].map(t=>e.l(t))).then(()=>t(545255)))},970795,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__bc724f60._.js"].map(t=>e.l(t))).then(()=>t(328112)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__311b0ff4._.js.map