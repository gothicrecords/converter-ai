{"version":3,"sources":["../../../lib/logger.js","../../../lib/errorTracker.js","../../../lib/diagnostics.js"],"sourcesContent":["/**\r\n * Advanced Structured Logging System\r\n * Provides comprehensive logging with different levels, transports, and error tracking\r\n */\r\n\r\nimport winston from 'winston';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Custom log format\r\nconst logFormat = winston.format.combine(\r\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),\r\n  winston.format.errors({ stack: true }),\r\n  winston.format.splat(),\r\n  winston.format.json()\r\n);\r\n\r\n// Console format for development\r\nconst consoleFormat = winston.format.combine(\r\n  winston.format.colorize(),\r\n  winston.format.timestamp({ format: 'HH:mm:ss' }),\r\n  winston.format.printf(({ timestamp, level, message, ...meta }) => {\r\n    let msg = `${timestamp} [${level}]: ${message}`;\r\n    if (Object.keys(meta).length > 0 && meta.stack) {\r\n      msg += `\\n${meta.stack}`;\r\n    } else if (Object.keys(meta).length > 0) {\r\n      msg += `\\n${JSON.stringify(meta, null, 2)}`;\r\n    }\r\n    return msg;\r\n  })\r\n);\r\n\r\n// Create logs directory if it doesn't exist\r\nconst logsDir = path.join(process.cwd(), 'logs');\r\n\r\n// Create Winston logger instance\r\nconst logger = winston.createLogger({\r\n  level: process.env.LOG_LEVEL || (process.env.NODE_ENV === 'production' ? 'info' : 'debug'),\r\n  format: logFormat,\r\n  defaultMeta: {\r\n    service: 'upscaler-ai',\r\n    environment: process.env.NODE_ENV || 'development',\r\n  },\r\n  transports: [\r\n    // Console transport\r\n    new winston.transports.Console({\r\n      format: process.env.NODE_ENV === 'production' \r\n        ? winston.format.json()\r\n        : consoleFormat,\r\n      handleExceptions: true,\r\n      handleRejections: true,\r\n    }),\r\n    \r\n    // Error log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'error.log'),\r\n      level: 'error',\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n    \r\n    // Combined log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'combined.log'),\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n  ],\r\n  exceptionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'exceptions.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n  rejectionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'rejections.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n});\r\n\r\n// Enhanced logging methods with context\r\nexport const log = {\r\n  /**\r\n   * Log error with full context\r\n   */\r\n  error: (message, error = null, context = {}) => {\r\n    const logData = {\r\n      message,\r\n      ...context,\r\n    };\r\n\r\n    if (error) {\r\n      logData.error = {\r\n        name: error.name,\r\n        message: error.message,\r\n        stack: error.stack,\r\n        code: error.code,\r\n        statusCode: error.statusCode,\r\n        details: error.details,\r\n      };\r\n    }\r\n\r\n    logger.error(message, logData);\r\n    return logData;\r\n  },\r\n\r\n  /**\r\n   * Log warning\r\n   */\r\n  warn: (message, context = {}) => {\r\n    logger.warn(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log info\r\n   */\r\n  info: (message, context = {}) => {\r\n    logger.info(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log debug (only in development)\r\n   */\r\n  debug: (message, context = {}) => {\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      logger.debug(message, context);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log API request\r\n   */\r\n  api: (req, res, responseTime = null) => {\r\n    const logData = {\r\n      method: req.method,\r\n      url: req.url,\r\n      path: req.path,\r\n      statusCode: res.statusCode,\r\n      userAgent: req.headers['user-agent'],\r\n      ip: req.ip || req.connection.remoteAddress,\r\n    };\r\n\r\n    if (responseTime) {\r\n      logData.responseTime = `${responseTime}ms`;\r\n    }\r\n\r\n    if (res.statusCode >= 400) {\r\n      logger.warn('API Request', logData);\r\n    } else {\r\n      logger.info('API Request', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log database operation\r\n   */\r\n  database: (operation, query = null, duration = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      duration: duration ? `${duration}ms` : null,\r\n    };\r\n\r\n    if (query) {\r\n      logData.query = typeof query === 'string' ? query : JSON.stringify(query);\r\n    }\r\n\r\n    if (error) {\r\n      logger.error('Database Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('Database Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log file operation\r\n   */\r\n  file: (operation, filePath, size = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      filePath,\r\n      size: size ? `${(size / 1024).toFixed(2)}KB` : null,\r\n    };\r\n\r\n    if (error) {\r\n      logger.error('File Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('File Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log performance metric\r\n   */\r\n  performance: (operation, duration, context = {}) => {\r\n    logger.info('Performance Metric', {\r\n      operation,\r\n      duration: `${duration}ms`,\r\n      ...context,\r\n    });\r\n  },\r\n};\r\n\r\n// Export default logger instance\r\nexport default logger;\r\n\r\n","/**\r\n * Advanced Error Tracking and Analysis System\r\n * Tracks errors, analyzes patterns, and provides actionable insights\r\n */\r\n\r\nimport { log } from './logger.js';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nconst ERROR_DB_PATH = path.join(process.cwd(), 'logs', 'errors.db.json');\r\n\r\n// Error patterns and solutions database\r\nconst ERROR_PATTERNS = {\r\n  // Database errors\r\n  'ECONNREFUSED': {\r\n    type: 'database',\r\n    severity: 'high',\r\n    solution: 'Check database connection settings and ensure database is running',\r\n    autoFix: false,\r\n  },\r\n  'ETIMEDOUT': {\r\n    type: 'network',\r\n    severity: 'medium',\r\n    solution: 'Check network connectivity and timeout settings',\r\n    autoFix: false,\r\n  },\r\n  'ENOENT': {\r\n    type: 'filesystem',\r\n    severity: 'medium',\r\n    solution: 'File or directory not found. Check file paths and permissions',\r\n    autoFix: true,\r\n  },\r\n  'EACCES': {\r\n    type: 'permission',\r\n    severity: 'high',\r\n    solution: 'Permission denied. Check file/directory permissions',\r\n    autoFix: false,\r\n  },\r\n  'EMFILE': {\r\n    type: 'resource',\r\n    severity: 'high',\r\n    solution: 'Too many open files. Increase ulimit or close file handles',\r\n    autoFix: false,\r\n  },\r\n  'LIMIT_FILE_SIZE': {\r\n    type: 'validation',\r\n    severity: 'low',\r\n    solution: 'File size exceeds limit. Check file size validation',\r\n    autoFix: false,\r\n  },\r\n  'VALIDATION_ERROR': {\r\n    type: 'validation',\r\n    severity: 'low',\r\n    solution: 'Input validation failed. Check input data format',\r\n    autoFix: false,\r\n  },\r\n  'AUTHENTICATION_ERROR': {\r\n    type: 'auth',\r\n    severity: 'medium',\r\n    solution: 'Authentication required. Check user session and tokens',\r\n    autoFix: false,\r\n  },\r\n};\r\n\r\nclass ErrorTracker {\r\n  constructor() {\r\n    this.errorCounts = new Map();\r\n    this.errorHistory = [];\r\n    this.maxHistorySize = 1000;\r\n  }\r\n\r\n  /**\r\n   * Track an error with full context\r\n   */\r\n  async trackError(error, context = {}) {\r\n    const errorInfo = {\r\n      id: this.generateErrorId(),\r\n      timestamp: new Date().toISOString(),\r\n      error: {\r\n        name: error.name,\r\n        message: error.message,\r\n        code: error.code,\r\n        stack: error.stack,\r\n        statusCode: error.statusCode,\r\n      },\r\n      context: {\r\n        ...context,\r\n        environment: process.env.NODE_ENV,\r\n        nodeVersion: process.version,\r\n      },\r\n      pattern: this.analyzeErrorPattern(error),\r\n      frequency: 1,\r\n    };\r\n\r\n    // Update error counts\r\n    const errorKey = this.getErrorKey(error);\r\n    const currentCount = this.errorCounts.get(errorKey) || 0;\r\n    this.errorCounts.set(errorKey, currentCount + 1);\r\n    errorInfo.frequency = currentCount + 1;\r\n\r\n    // Add to history\r\n    this.errorHistory.push(errorInfo);\r\n    if (this.errorHistory.length > this.maxHistorySize) {\r\n      this.errorHistory.shift();\r\n    }\r\n\r\n    // Log error\r\n    log.error('Error Tracked', error, {\r\n      errorId: errorInfo.id,\r\n      pattern: errorInfo.pattern,\r\n      frequency: errorInfo.frequency,\r\n      ...context,\r\n    });\r\n\r\n    // Save to persistent storage\r\n    await this.saveErrorToDB(errorInfo);\r\n\r\n    // Check if error needs immediate attention\r\n    if (this.shouldAlert(errorInfo)) {\r\n      await this.sendAlert(errorInfo);\r\n    }\r\n\r\n    return errorInfo;\r\n  }\r\n\r\n  /**\r\n   * Analyze error pattern and suggest solution\r\n   */\r\n  analyzeErrorPattern(error) {\r\n    const pattern = {\r\n      type: 'unknown',\r\n      severity: 'low',\r\n      solution: null,\r\n      autoFixable: false,\r\n      similarErrors: [],\r\n    };\r\n\r\n    // Check error code\r\n    if (error.code && ERROR_PATTERNS[error.code]) {\r\n      const match = ERROR_PATTERNS[error.code];\r\n      pattern.type = match.type;\r\n      pattern.severity = match.severity;\r\n      pattern.solution = match.solution;\r\n      pattern.autoFixable = match.autoFix;\r\n    }\r\n\r\n    // Check error message for patterns\r\n    if (error.message) {\r\n      const message = error.message.toLowerCase();\r\n      \r\n      if (message.includes('timeout')) {\r\n        pattern.type = 'timeout';\r\n        pattern.severity = 'medium';\r\n        pattern.solution = 'Operation timed out. Consider increasing timeout or optimizing operation';\r\n      } else if (message.includes('memory')) {\r\n        pattern.type = 'memory';\r\n        pattern.severity = 'high';\r\n        pattern.solution = 'Memory issue detected. Check memory usage and optimize';\r\n      } else if (message.includes('permission') || message.includes('access')) {\r\n        pattern.type = 'permission';\r\n        pattern.severity = 'high';\r\n        pattern.solution = 'Permission issue. Check file/directory permissions';\r\n      }\r\n    }\r\n\r\n    // Find similar errors\r\n    pattern.similarErrors = this.findSimilarErrors(error);\r\n\r\n    return pattern;\r\n  }\r\n\r\n  /**\r\n   * Find similar errors in history\r\n   */\r\n  findSimilarErrors(error, limit = 5) {\r\n    return this.errorHistory\r\n      .filter(e => {\r\n        // Similar if same error name or similar message\r\n        return e.error.name === error.name ||\r\n               (e.error.message && error.message && \r\n                this.similarity(e.error.message, error.message) > 0.7);\r\n      })\r\n      .slice(-limit)\r\n      .map(e => ({\r\n        id: e.id,\r\n        timestamp: e.timestamp,\r\n        message: e.error.message,\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * Calculate string similarity (simple Jaccard similarity)\r\n   */\r\n  similarity(str1, str2) {\r\n    const words1 = new Set(str1.toLowerCase().split(/\\s+/));\r\n    const words2 = new Set(str2.toLowerCase().split(/\\s+/));\r\n    const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n    const union = new Set([...words1, ...words2]);\r\n    return intersection.size / union.size;\r\n  }\r\n\r\n  /**\r\n   * Generate unique error ID\r\n   */\r\n  generateErrorId() {\r\n    return `ERR-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  /**\r\n   * Get error key for counting\r\n   */\r\n  getErrorKey(error) {\r\n    return `${error.name || 'Error'}:${error.code || 'NO_CODE'}:${error.message?.substring(0, 50) || 'NO_MESSAGE'}`;\r\n  }\r\n\r\n  /**\r\n   * Check if error should trigger alert\r\n   */\r\n  shouldAlert(errorInfo) {\r\n    // Alert if high severity\r\n    if (errorInfo.pattern.severity === 'high') {\r\n      return true;\r\n    }\r\n\r\n    // Alert if error frequency is high\r\n    if (errorInfo.frequency > 10) {\r\n      return true;\r\n    }\r\n\r\n    // Alert if same error occurred multiple times in short period\r\n    const recentSimilar = this.errorHistory\r\n      .filter(e => \r\n        e.error.name === errorInfo.error.name &&\r\n        new Date(e.timestamp) > new Date(Date.now() - 5 * 60 * 1000) // Last 5 minutes\r\n      ).length;\r\n\r\n    return recentSimilar > 5;\r\n  }\r\n\r\n  /**\r\n   * Send alert for critical errors\r\n   */\r\n  async sendAlert(errorInfo) {\r\n    log.warn('Error Alert Triggered', {\r\n      errorId: errorInfo.id,\r\n      severity: errorInfo.pattern.severity,\r\n      frequency: errorInfo.frequency,\r\n      solution: errorInfo.pattern.solution,\r\n    });\r\n\r\n    // In production, you could send to monitoring service\r\n    // Example: Sentry, PagerDuty, Slack, etc.\r\n    if (process.env.ERROR_ALERT_WEBHOOK) {\r\n      try {\r\n        await fetch(process.env.ERROR_ALERT_WEBHOOK, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            error: errorInfo.error,\r\n            pattern: errorInfo.pattern,\r\n            frequency: errorInfo.frequency,\r\n            timestamp: errorInfo.timestamp,\r\n          }),\r\n        });\r\n      } catch (e) {\r\n        log.error('Failed to send error alert', e);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save error to persistent database\r\n   */\r\n  async saveErrorToDB(errorInfo) {\r\n    try {\r\n      // Ensure logs directory exists\r\n      const logsDir = path.dirname(ERROR_DB_PATH);\r\n      await fs.mkdir(logsDir, { recursive: true });\r\n\r\n      // Read existing errors\r\n      let errors = [];\r\n      try {\r\n        const data = await fs.readFile(ERROR_DB_PATH, 'utf-8');\r\n        errors = JSON.parse(data);\r\n      } catch (e) {\r\n        // File doesn't exist or is invalid, start fresh\r\n      }\r\n\r\n      // Add new error\r\n      errors.push(errorInfo);\r\n\r\n      // Keep only last 10000 errors\r\n      if (errors.length > 10000) {\r\n        errors = errors.slice(-10000);\r\n      }\r\n\r\n      // Write back\r\n      await fs.writeFile(ERROR_DB_PATH, JSON.stringify(errors, null, 2));\r\n    } catch (e) {\r\n      log.error('Failed to save error to DB', e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get error statistics\r\n   */\r\n  getStats() {\r\n    const stats = {\r\n      totalErrors: this.errorHistory.length,\r\n      uniqueErrors: this.errorCounts.size,\r\n      errorsByType: {},\r\n      errorsBySeverity: {},\r\n      recentErrors: this.errorHistory.slice(-10),\r\n      topErrors: Array.from(this.errorCounts.entries())\r\n        .sort((a, b) => b[1] - a[1])\r\n        .slice(0, 10)\r\n        .map(([key, count]) => ({ error: key, count })),\r\n    };\r\n\r\n    // Count by type\r\n    this.errorHistory.forEach(e => {\r\n      const type = e.pattern.type;\r\n      stats.errorsByType[type] = (stats.errorsByType[type] || 0) + 1;\r\n    });\r\n\r\n    // Count by severity\r\n    this.errorHistory.forEach(e => {\r\n      const severity = e.pattern.severity;\r\n      stats.errorsBySeverity[severity] = (stats.errorsBySeverity[severity] || 0) + 1;\r\n    });\r\n\r\n    return stats;\r\n  }\r\n\r\n  /**\r\n   * Get errors by pattern\r\n   */\r\n  getErrorsByPattern(patternType) {\r\n    return this.errorHistory.filter(e => e.pattern.type === patternType);\r\n  }\r\n\r\n  /**\r\n   * Clear error history\r\n   */\r\n  clearHistory() {\r\n    this.errorHistory = [];\r\n    this.errorCounts.clear();\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst errorTracker = new ErrorTracker();\r\n\r\nexport default errorTracker;\r\n\r\n","/**\r\n * Advanced Diagnostics System\r\n * Comprehensive health checks, system analysis, and automated problem detection\r\n */\r\n\r\nimport { log } from './logger.js';\r\nimport errorTracker from './errorTracker.js';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\nimport os from 'os';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nclass DiagnosticsSystem {\r\n  constructor() {\r\n    this.checks = new Map();\r\n    this.healthStatus = {\r\n      overall: 'unknown',\r\n      checks: {},\r\n      timestamp: null,\r\n      system: {},\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Register a health check\r\n   */\r\n  registerCheck(name, checkFunction, options = {}) {\r\n    this.checks.set(name, {\r\n      fn: checkFunction,\r\n      critical: options.critical !== false,\r\n      interval: options.interval || 60000, // Default 1 minute\r\n      timeout: options.timeout || 5000,\r\n      lastRun: null,\r\n      lastResult: null,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Run all health checks\r\n   */\r\n  async runAllChecks() {\r\n    const results = {};\r\n    const startTime = Date.now();\r\n\r\n    // System information\r\n    results.system = await this.getSystemInfo();\r\n\r\n    // Run all registered checks\r\n    for (const [name, check] of this.checks.entries()) {\r\n      try {\r\n        const result = await this.runCheck(name, check);\r\n        results[name] = result;\r\n      } catch (error) {\r\n        log.error(`Health check failed: ${name}`, error);\r\n        results[name] = {\r\n          status: 'error',\r\n          message: error.message,\r\n          error: error.name,\r\n        };\r\n      }\r\n    }\r\n\r\n    // Determine overall health\r\n    const criticalChecks = Array.from(this.checks.entries())\r\n      .filter(([_, check]) => check.critical)\r\n      .map(([name]) => name);\r\n\r\n    const criticalFailed = criticalChecks.some(name => \r\n      results[name]?.status === 'error' || results[name]?.status === 'unhealthy'\r\n    );\r\n\r\n    const overallStatus = criticalFailed ? 'unhealthy' : \r\n                         Object.values(results).some(r => r?.status === 'warning') ? 'degraded' : \r\n                         'healthy';\r\n\r\n    this.healthStatus = {\r\n      overall: overallStatus,\r\n      checks: results,\r\n      timestamp: new Date().toISOString(),\r\n      system: results.system,\r\n      duration: Date.now() - startTime,\r\n    };\r\n\r\n    return this.healthStatus;\r\n  }\r\n\r\n  /**\r\n   * Run a single health check\r\n   */\r\n  async runCheck(name, check) {\r\n    const startTime = Date.now();\r\n    \r\n    try {\r\n      // Run check with timeout\r\n      const result = await Promise.race([\r\n        check.fn(),\r\n        new Promise((_, reject) => \r\n          setTimeout(() => reject(new Error('Check timeout')), check.timeout)\r\n        ),\r\n      ]);\r\n\r\n      const duration = Date.now() - startTime;\r\n      check.lastRun = new Date();\r\n      check.lastResult = result;\r\n\r\n      return {\r\n        status: result.status || 'healthy',\r\n        message: result.message,\r\n        data: result.data,\r\n        duration: `${duration}ms`,\r\n        timestamp: check.lastRun.toISOString(),\r\n      };\r\n    } catch (error) {\r\n      check.lastRun = new Date();\r\n      check.lastResult = { status: 'error', error: error.message };\r\n\r\n      return {\r\n        status: 'error',\r\n        message: error.message,\r\n        duration: `${Date.now() - startTime}ms`,\r\n        timestamp: check.lastRun.toISOString(),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get system information\r\n   */\r\n  async getSystemInfo() {\r\n    const cpus = os.cpus();\r\n    const totalMem = os.totalmem();\r\n    const freeMem = os.freemem();\r\n    const usedMem = totalMem - freeMem;\r\n\r\n    return {\r\n      platform: os.platform(),\r\n      arch: os.arch(),\r\n      nodeVersion: process.version,\r\n      uptime: `${Math.floor(os.uptime() / 3600)}h ${Math.floor((os.uptime() % 3600) / 60)}m`,\r\n      cpu: {\r\n        model: cpus[0]?.model || 'Unknown',\r\n        cores: cpus.length,\r\n        usage: process.cpuUsage(),\r\n      },\r\n      memory: {\r\n        total: `${(totalMem / 1024 / 1024 / 1024).toFixed(2)}GB`,\r\n        free: `${(freeMem / 1024 / 1024 / 1024).toFixed(2)}GB`,\r\n        used: `${(usedMem / 1024 / 1024 / 1024).toFixed(2)}GB`,\r\n        usagePercent: `${((usedMem / totalMem) * 100).toFixed(2)}%`,\r\n      },\r\n      loadAverage: os.loadavg(),\r\n      environment: process.env.NODE_ENV || 'development',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check database connectivity\r\n   */\r\n  async checkDatabase() {\r\n    try {\r\n      // Try to import and check database connection\r\n      const { createClient } = await import('@supabase/supabase-js');\r\n      \r\n      if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\r\n        return {\r\n          status: 'warning',\r\n          message: 'Database credentials not configured',\r\n        };\r\n      }\r\n\r\n      const supabase = createClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n      );\r\n\r\n      // Simple query to test connection\r\n      const { error } = await supabase.from('_health_check').select('1').limit(1);\r\n      \r\n      // If table doesn't exist, that's ok - connection works\r\n      if (error && error.code !== 'PGRST116') {\r\n        return {\r\n          status: 'unhealthy',\r\n          message: `Database connection failed: ${error.message}`,\r\n        };\r\n      }\r\n\r\n      return {\r\n        status: 'healthy',\r\n        message: 'Database connection successful',\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: `Database check failed: ${error.message}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check file system\r\n   */\r\n  async checkFileSystem() {\r\n    try {\r\n      const uploadsDir = path.join(process.cwd(), 'uploads');\r\n      const logsDir = path.join(process.cwd(), 'logs');\r\n      const tmpDir = path.join(process.cwd(), 'tmp');\r\n\r\n      const dirs = [uploadsDir, logsDir, tmpDir];\r\n      const results = {};\r\n\r\n      for (const dir of dirs) {\r\n        try {\r\n          await fs.access(dir);\r\n          const stats = await fs.stat(dir);\r\n          results[path.basename(dir)] = {\r\n            exists: true,\r\n            writable: true,\r\n            isDirectory: stats.isDirectory(),\r\n          };\r\n        } catch (error) {\r\n          if (error.code === 'ENOENT') {\r\n            // Try to create directory\r\n            try {\r\n              await fs.mkdir(dir, { recursive: true });\r\n              results[path.basename(dir)] = {\r\n                exists: true,\r\n                writable: true,\r\n                created: true,\r\n              };\r\n            } catch (createError) {\r\n              results[path.basename(dir)] = {\r\n                exists: false,\r\n                writable: false,\r\n                error: createError.message,\r\n              };\r\n            }\r\n          } else {\r\n            results[path.basename(dir)] = {\r\n              exists: false,\r\n              writable: false,\r\n              error: error.message,\r\n            };\r\n          }\r\n        }\r\n      }\r\n\r\n      const hasErrors = Object.values(results).some(r => !r.exists || !r.writable);\r\n\r\n      return {\r\n        status: hasErrors ? 'warning' : 'healthy',\r\n        message: hasErrors ? 'Some directories have issues' : 'File system healthy',\r\n        data: results,\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: `File system check failed: ${error.message}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check environment variables\r\n   */\r\n  async checkEnvironment() {\r\n    const required = [\r\n      'NODE_ENV',\r\n    ];\r\n\r\n    const optional = [\r\n      'NEXT_PUBLIC_SUPABASE_URL',\r\n      'NEXT_PUBLIC_SUPABASE_ANON_KEY',\r\n      'CLOUDINARY_CLOUD_NAME',\r\n      'CLOUDINARY_API_KEY',\r\n      'STRIPE_SECRET_KEY',\r\n      'HF_API_TOKEN',\r\n    ];\r\n\r\n    const missing = required.filter(key => !process.env[key]);\r\n    const configured = optional.filter(key => process.env[key]);\r\n\r\n    return {\r\n      status: missing.length > 0 ? 'warning' : 'healthy',\r\n      message: missing.length > 0 \r\n        ? `Missing required environment variables: ${missing.join(', ')}`\r\n        : 'Environment variables configured',\r\n      data: {\r\n        required: {\r\n          total: required.length,\r\n          configured: required.length - missing.length,\r\n          missing,\r\n        },\r\n        optional: {\r\n          total: optional.length,\r\n          configured: configured.length,\r\n          configuredKeys: configured,\r\n        },\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check error statistics\r\n   */\r\n  async checkErrors() {\r\n    try {\r\n      const stats = errorTracker.getStats();\r\n      const recentErrors = stats.recentErrors.filter(e => {\r\n        const errorTime = new Date(e.timestamp);\r\n        const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);\r\n        return errorTime > fiveMinutesAgo;\r\n      });\r\n\r\n      const highSeverityErrors = stats.recentErrors.filter(e => \r\n        e.pattern?.severity === 'high'\r\n      );\r\n\r\n      let status = 'healthy';\r\n      let message = 'No recent errors';\r\n\r\n      if (highSeverityErrors.length > 0) {\r\n        status = 'unhealthy';\r\n        message = `${highSeverityErrors.length} high severity errors in last 5 minutes`;\r\n      } else if (recentErrors.length > 10) {\r\n        status = 'warning';\r\n        message = `${recentErrors.length} errors in last 5 minutes`;\r\n      }\r\n\r\n      return {\r\n        status,\r\n        message,\r\n        data: {\r\n          totalErrors: stats.totalErrors,\r\n          uniqueErrors: stats.uniqueErrors,\r\n          recentErrors: recentErrors.length,\r\n          highSeverityErrors: highSeverityErrors.length,\r\n          topErrors: stats.topErrors.slice(0, 5),\r\n        },\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: `Error check failed: ${error.message}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check disk space\r\n   */\r\n  async checkDiskSpace() {\r\n    try {\r\n      // Check if we can write to temp directory\r\n      const testFile = path.join(process.cwd(), 'tmp', '.health-check');\r\n      try {\r\n        await fs.writeFile(testFile, 'test');\r\n        await fs.unlink(testFile);\r\n        \r\n        return {\r\n          status: 'healthy',\r\n          message: 'Disk space available',\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          status: 'warning',\r\n          message: `Disk write test failed: ${error.message}`,\r\n        };\r\n      }\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: `Disk space check failed: ${error.message}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get comprehensive diagnostics report\r\n   */\r\n  async getFullDiagnostics() {\r\n    const diagnostics = {\r\n      timestamp: new Date().toISOString(),\r\n      health: await this.runAllChecks(),\r\n      errorStats: errorTracker.getStats(),\r\n      recommendations: await this.getRecommendations(),\r\n    };\r\n\r\n    return diagnostics;\r\n  }\r\n\r\n  /**\r\n   * Get recommendations based on diagnostics\r\n   */\r\n  async getRecommendations() {\r\n    const recommendations = [];\r\n    const health = this.healthStatus;\r\n\r\n    // Check memory usage\r\n    if (health.system?.memory) {\r\n      const usagePercent = parseFloat(health.system.memory.usagePercent);\r\n      if (usagePercent > 90) {\r\n        recommendations.push({\r\n          type: 'memory',\r\n          severity: 'high',\r\n          message: 'Memory usage is very high. Consider optimizing memory usage or scaling up.',\r\n          action: 'Review memory-intensive operations and consider caching strategies',\r\n        });\r\n      } else if (usagePercent > 75) {\r\n        recommendations.push({\r\n          type: 'memory',\r\n          severity: 'medium',\r\n          message: 'Memory usage is elevated. Monitor closely.',\r\n          action: 'Review memory usage patterns',\r\n        });\r\n      }\r\n    }\r\n\r\n    // Check error rates\r\n    const errorStats = errorTracker.getStats();\r\n    if (errorStats.recentErrors.length > 20) {\r\n      recommendations.push({\r\n        type: 'errors',\r\n        severity: 'high',\r\n        message: 'High error rate detected. Immediate attention required.',\r\n        action: 'Review error logs and fix critical issues',\r\n      });\r\n    }\r\n\r\n    // Check file system\r\n    const fsCheck = health.checks?.fileSystem;\r\n    if (fsCheck?.status === 'warning' || fsCheck?.status === 'error') {\r\n      recommendations.push({\r\n        type: 'filesystem',\r\n        severity: 'medium',\r\n        message: 'File system issues detected',\r\n        action: 'Check directory permissions and disk space',\r\n      });\r\n    }\r\n\r\n    // Check database\r\n    const dbCheck = health.checks?.database;\r\n    if (dbCheck?.status === 'unhealthy' || dbCheck?.status === 'error') {\r\n      recommendations.push({\r\n        type: 'database',\r\n        severity: 'high',\r\n        message: 'Database connectivity issues',\r\n        action: 'Check database connection settings and ensure database is running',\r\n      });\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  /**\r\n   * Initialize default health checks\r\n   */\r\n  initializeDefaultChecks() {\r\n    this.registerCheck('database', () => this.checkDatabase(), { critical: true });\r\n    this.registerCheck('fileSystem', () => this.checkFileSystem(), { critical: true });\r\n    this.registerCheck('environment', () => this.checkEnvironment(), { critical: false });\r\n    this.registerCheck('errors', () => this.checkErrors(), { critical: false });\r\n    this.registerCheck('diskSpace', () => this.checkDiskSpace(), { critical: false });\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst diagnostics = new DiagnosticsSystem();\r\ndiagnostics.initializeDefaultChecks();\r\n\r\nexport default diagnostics;\r\n\r\n"],"names":[],"mappings":"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"}