module.exports=[270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},49489,e=>{"use strict";var t=e.i(926747),r=e.i(190406),s=e.i(244898),a=e.i(262950);let i="https://ckctyvebrkcemcgllpbc.supabase.co",n=process.env.SUPABASE_SERVICE_ROLE_KEY;async function o(e,t){if("OPTIONS"===e.method){t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),t.status(200).end();return}if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let r=e.headers.authorization?.replace("Bearer ","");if(!r)return t.status(401).json({error:"No session token provided"});let{toolName:s}=e.body;if(!s)return t.status(400).json({error:"Tool name is required"});let a=await fetch(`${i}/rest/v1/user_sessions?session_token=eq.${r}&select=user_id,expires_at`,{headers:{apikey:n,Authorization:`Bearer ${n}`}}),o=await a.json();if(!o||0===o.length||new Date(o[0].expires_at)<new Date)return t.status(401).json({error:"Invalid or expired session"});let l=o[0],d=await fetch(`${i}/rest/v1/users?id=eq.${l.user_id}&select=images_processed,tools_used`,{headers:{apikey:n,Authorization:`Bearer ${n}`}}),u=await d.json();if(!u||0===u.length)return t.status(404).json({error:"User not found"});let p=u[0],c=p.tools_used||[];c.includes(s)||c.push(s);let h=await fetch(`${i}/rest/v1/users?id=eq.${l.user_id}`,{method:"PATCH",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify({images_processed:p.images_processed+1,tools_used:c,updated_at:new Date().toISOString()})}),f=await h.json();t.status(200).json({success:!0,user:f[0]})}catch(e){console.error("Update stats error:",e),t.status(500).json({error:"Internal server error"})}}e.s(["default",()=>o],622561);var l=e.i(622561),d=e.i(7031),u=e.i(181927),p=e.i(846432);let c=(0,a.hoist)(l,"default"),h=(0,a.hoist)(l,"config"),f=new s.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/users/stats",pathname:"/api/users/stats",bundlePath:"",filename:""},userland:l,distDir:".next-build",relativeProjectDir:""});async function v(e,r,s){f.isDev&&(0,p.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/users/stats";a=a.replace(/\/index$/,"")||"/";let i=await f.prepare(e,r,{srcPage:a});if(!i){r.statusCode=400,r.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve());return}let{query:n,params:o,prerenderManifest:l,routerServerContext:c}=i;try{let t=e.method||"GET",s=(0,d.getTracer)(),i=s.getActiveScopeSpan(),p=f.instrumentationOnRequestError.bind(f),h=async i=>f.render(e,r,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:f.isDev,page:"/api/users/stats",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>p(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${t} ${n}`;i.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),i.updateName(e)}else i.updateName(`${t} ${a}`)});i?await h(i):await s.withPropagatedContext(e.headers,()=>s.trace(u.BaseServerSpan.handleRequest,{spanName:`${t} ${a}`,kind:d.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},h))}catch(e){if(f.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==s.waitUntil||s.waitUntil.call(s,Promise.resolve())}}e.s(["config",0,h,"default",0,c,"handler",()=>v],49489)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__eb5d3bd6._.js.map