{"version":3,"sources":["../../../lib/logger.js"],"sourcesContent":["/**\r\n * Advanced Structured Logging System\r\n * Provides comprehensive logging with different levels, transports, and error tracking\r\n */\r\n\r\nimport winston from 'winston';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Custom log format\r\nconst logFormat = winston.format.combine(\r\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),\r\n  winston.format.errors({ stack: true }),\r\n  winston.format.splat(),\r\n  winston.format.json()\r\n);\r\n\r\n// Console format for development\r\nconst consoleFormat = winston.format.combine(\r\n  winston.format.colorize(),\r\n  winston.format.timestamp({ format: 'HH:mm:ss' }),\r\n  winston.format.printf(({ timestamp, level, message, ...meta }) => {\r\n    let msg = `${timestamp} [${level}]: ${message}`;\r\n    if (Object.keys(meta).length > 0 && meta.stack) {\r\n      msg += `\\n${meta.stack}`;\r\n    } else if (Object.keys(meta).length > 0) {\r\n      msg += `\\n${JSON.stringify(meta, null, 2)}`;\r\n    }\r\n    return msg;\r\n  })\r\n);\r\n\r\n// Create logs directory if it doesn't exist\r\nconst logsDir = path.join(process.cwd(), 'logs');\r\n\r\n// Create Winston logger instance\r\nconst logger = winston.createLogger({\r\n  level: process.env.LOG_LEVEL || (process.env.NODE_ENV === 'production' ? 'info' : 'debug'),\r\n  format: logFormat,\r\n  defaultMeta: {\r\n    service: 'upscaler-ai',\r\n    environment: process.env.NODE_ENV || 'development',\r\n  },\r\n  transports: [\r\n    // Console transport\r\n    new winston.transports.Console({\r\n      format: process.env.NODE_ENV === 'production' \r\n        ? winston.format.json()\r\n        : consoleFormat,\r\n      handleExceptions: true,\r\n      handleRejections: true,\r\n    }),\r\n    \r\n    // Error log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'error.log'),\r\n      level: 'error',\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n    \r\n    // Combined log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'combined.log'),\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n  ],\r\n  exceptionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'exceptions.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n  rejectionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'rejections.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n});\r\n\r\n// Enhanced logging methods with context\r\nexport const log = {\r\n  /**\r\n   * Log error with full context\r\n   */\r\n  error: (message, error = null, context = {}) => {\r\n    const logData = {\r\n      message,\r\n      ...context,\r\n    };\r\n\r\n    if (error) {\r\n      logData.error = {\r\n        name: error.name,\r\n        message: error.message,\r\n        stack: error.stack,\r\n        code: error.code,\r\n        statusCode: error.statusCode,\r\n        details: error.details,\r\n      };\r\n    }\r\n\r\n    logger.error(message, logData);\r\n    return logData;\r\n  },\r\n\r\n  /**\r\n   * Log warning\r\n   */\r\n  warn: (message, context = {}) => {\r\n    logger.warn(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log info\r\n   */\r\n  info: (message, context = {}) => {\r\n    logger.info(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log debug (only in development)\r\n   */\r\n  debug: (message, context = {}) => {\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      logger.debug(message, context);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log API request\r\n   */\r\n  api: (req, res, responseTime = null) => {\r\n    const logData = {\r\n      method: req.method,\r\n      url: req.url,\r\n      path: req.path,\r\n      statusCode: res.statusCode,\r\n      userAgent: req.headers['user-agent'],\r\n      ip: req.ip || req.connection.remoteAddress,\r\n    };\r\n\r\n    if (responseTime) {\r\n      logData.responseTime = `${responseTime}ms`;\r\n    }\r\n\r\n    if (res.statusCode >= 400) {\r\n      logger.warn('API Request', logData);\r\n    } else {\r\n      logger.info('API Request', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log database operation\r\n   */\r\n  database: (operation, query = null, duration = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      duration: duration ? `${duration}ms` : null,\r\n    };\r\n\r\n    if (query) {\r\n      logData.query = typeof query === 'string' ? query : JSON.stringify(query);\r\n    }\r\n\r\n    if (error) {\r\n      logger.error('Database Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('Database Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log file operation\r\n   */\r\n  file: (operation, filePath, size = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      filePath,\r\n      size: size ? `${(size / 1024).toFixed(2)}KB` : null,\r\n    };\r\n\r\n    if (error) {\r\n      logger.error('File Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('File Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log performance metric\r\n   */\r\n  performance: (operation, duration, context = {}) => {\r\n    logger.info('Performance Metric', {\r\n      operation,\r\n      duration: `${duration}ms`,\r\n      ...context,\r\n    });\r\n  },\r\n};\r\n\r\n// Export default logger instance\r\nexport default logger;\r\n\r\n"],"names":[],"mappings":"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"}