{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jurit/OneDrive/Desktop/sito%20upscale/lib/logger.js"],"sourcesContent":["/**\r\n * Advanced Structured Logging System\r\n * Provides comprehensive logging with different levels, transports, and error tracking\r\n */\r\n\r\nimport winston from 'winston';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Custom log format\r\nconst logFormat = winston.format.combine(\r\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),\r\n  winston.format.errors({ stack: true }),\r\n  winston.format.splat(),\r\n  winston.format.json()\r\n);\r\n\r\n// Console format for development\r\nconst consoleFormat = winston.format.combine(\r\n  winston.format.colorize(),\r\n  winston.format.timestamp({ format: 'HH:mm:ss' }),\r\n  winston.format.printf(({ timestamp, level, message, ...meta }) => {\r\n    let msg = `${timestamp} [${level}]: ${message}`;\r\n    if (Object.keys(meta).length > 0 && meta.stack) {\r\n      msg += `\\n${meta.stack}`;\r\n    } else if (Object.keys(meta).length > 0) {\r\n      msg += `\\n${JSON.stringify(meta, null, 2)}`;\r\n    }\r\n    return msg;\r\n  })\r\n);\r\n\r\n// Create logs directory if it doesn't exist\r\nconst logsDir = path.join(process.cwd(), 'logs');\r\n\r\n// Create Winston logger instance\r\nconst logger = winston.createLogger({\r\n  level: process.env.LOG_LEVEL || (process.env.NODE_ENV === 'production' ? 'info' : 'debug'),\r\n  format: logFormat,\r\n  defaultMeta: {\r\n    service: 'upscaler-ai',\r\n    environment: process.env.NODE_ENV || 'development',\r\n  },\r\n  transports: [\r\n    // Console transport\r\n    new winston.transports.Console({\r\n      format: process.env.NODE_ENV === 'production' \r\n        ? winston.format.json()\r\n        : consoleFormat,\r\n      handleExceptions: true,\r\n      handleRejections: true,\r\n    }),\r\n    \r\n    // Error log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'error.log'),\r\n      level: 'error',\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n    \r\n    // Combined log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'combined.log'),\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n  ],\r\n  exceptionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'exceptions.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n  rejectionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'rejections.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n});\r\n\r\n// Enhanced logging methods with context\r\nexport const log = {\r\n  /**\r\n   * Log error with full context\r\n   */\r\n  error: (message, error = null, context = {}) => {\r\n    const logData = {\r\n      message,\r\n      ...context,\r\n    };\r\n\r\n    if (error) {\r\n      logData.error = {\r\n        name: error.name,\r\n        message: error.message,\r\n        stack: error.stack,\r\n        code: error.code,\r\n        statusCode: error.statusCode,\r\n        details: error.details,\r\n      };\r\n    }\r\n\r\n    logger.error(message, logData);\r\n    return logData;\r\n  },\r\n\r\n  /**\r\n   * Log warning\r\n   */\r\n  warn: (message, context = {}) => {\r\n    logger.warn(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log info\r\n   */\r\n  info: (message, context = {}) => {\r\n    logger.info(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log debug (only in development)\r\n   */\r\n  debug: (message, context = {}) => {\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      logger.debug(message, context);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log API request\r\n   */\r\n  api: (req, res, responseTime = null) => {\r\n    const logData = {\r\n      method: req.method,\r\n      url: req.url,\r\n      path: req.path,\r\n      statusCode: res.statusCode,\r\n      userAgent: req.headers['user-agent'],\r\n      ip: req.ip || req.connection.remoteAddress,\r\n    };\r\n\r\n    if (responseTime) {\r\n      logData.responseTime = `${responseTime}ms`;\r\n    }\r\n\r\n    if (res.statusCode >= 400) {\r\n      logger.warn('API Request', logData);\r\n    } else {\r\n      logger.info('API Request', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log database operation\r\n   */\r\n  database: (operation, query = null, duration = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      duration: duration ? `${duration}ms` : null,\r\n    };\r\n\r\n    if (query) {\r\n      logData.query = typeof query === 'string' ? query : JSON.stringify(query);\r\n    }\r\n\r\n    if (error) {\r\n      logger.error('Database Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('Database Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log file operation\r\n   */\r\n  file: (operation, filePath, size = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      filePath,\r\n      size: size ? `${(size / 1024).toFixed(2)}KB` : null,\r\n    };\r\n\r\n    if (error) {\r\n      logger.error('File Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('File Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log performance metric\r\n   */\r\n  performance: (operation, duration, context = {}) => {\r\n    logger.info('Performance Metric', {\r\n      operation,\r\n      duration: `${duration}ms`,\r\n      ...context,\r\n    });\r\n  },\r\n};\r\n\r\n// Export default logger instance\r\nexport default logger;\r\n\r\n"],"names":[],"mappings":"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"}}]
}