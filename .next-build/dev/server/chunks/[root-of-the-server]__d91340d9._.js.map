{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jurit/OneDrive/Desktop/sito%20upscale/lib/logger.js"],"sourcesContent":["/**\r\n * Advanced Structured Logging System\r\n * Provides comprehensive logging with different levels, transports, and error tracking\r\n */\r\n\r\nimport winston from 'winston';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Custom log format\r\nconst logFormat = winston.format.combine(\r\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),\r\n  winston.format.errors({ stack: true }),\r\n  winston.format.splat(),\r\n  winston.format.json()\r\n);\r\n\r\n// Console format for development\r\nconst consoleFormat = winston.format.combine(\r\n  winston.format.colorize(),\r\n  winston.format.timestamp({ format: 'HH:mm:ss' }),\r\n  winston.format.printf(({ timestamp, level, message, ...meta }) => {\r\n    let msg = `${timestamp} [${level}]: ${message}`;\r\n    if (Object.keys(meta).length > 0 && meta.stack) {\r\n      msg += `\\n${meta.stack}`;\r\n    } else if (Object.keys(meta).length > 0) {\r\n      msg += `\\n${JSON.stringify(meta, null, 2)}`;\r\n    }\r\n    return msg;\r\n  })\r\n);\r\n\r\n// Create logs directory if it doesn't exist\r\nconst logsDir = path.join(process.cwd(), 'logs');\r\n\r\n// Create Winston logger instance\r\nconst logger = winston.createLogger({\r\n  level: process.env.LOG_LEVEL || (process.env.NODE_ENV === 'production' ? 'info' : 'debug'),\r\n  format: logFormat,\r\n  defaultMeta: {\r\n    service: 'upscaler-ai',\r\n    environment: process.env.NODE_ENV || 'development',\r\n  },\r\n  transports: [\r\n    // Console transport\r\n    new winston.transports.Console({\r\n      format: process.env.NODE_ENV === 'production' \r\n        ? winston.format.json()\r\n        : consoleFormat,\r\n      handleExceptions: true,\r\n      handleRejections: true,\r\n    }),\r\n    \r\n    // Error log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'error.log'),\r\n      level: 'error',\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n    \r\n    // Combined log file\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'combined.log'),\r\n      maxsize: 5242880, // 5MB\r\n      maxFiles: 5,\r\n      format: logFormat,\r\n    }),\r\n  ],\r\n  exceptionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'exceptions.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n  rejectionHandlers: [\r\n    new winston.transports.File({\r\n      filename: path.join(logsDir, 'rejections.log'),\r\n      maxsize: 5242880,\r\n      maxFiles: 3,\r\n    }),\r\n  ],\r\n});\r\n\r\n// Enhanced logging methods with context\r\nexport const log = {\r\n  /**\r\n   * Log error with full context\r\n   */\r\n  error: (message, error = null, context = {}) => {\r\n    const logData = {\r\n      message,\r\n      ...context,\r\n    };\r\n\r\n    if (error) {\r\n      logData.error = {\r\n        name: error.name,\r\n        message: error.message,\r\n        stack: error.stack,\r\n        code: error.code,\r\n        statusCode: error.statusCode,\r\n        details: error.details,\r\n      };\r\n    }\r\n\r\n    logger.error(message, logData);\r\n    return logData;\r\n  },\r\n\r\n  /**\r\n   * Log warning\r\n   */\r\n  warn: (message, context = {}) => {\r\n    logger.warn(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log info\r\n   */\r\n  info: (message, context = {}) => {\r\n    logger.info(message, context);\r\n  },\r\n\r\n  /**\r\n   * Log debug (only in development)\r\n   */\r\n  debug: (message, context = {}) => {\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      logger.debug(message, context);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log API request\r\n   */\r\n  api: (req, res, responseTime = null) => {\r\n    const logData = {\r\n      method: req.method,\r\n      url: req.url,\r\n      path: req.path,\r\n      statusCode: res.statusCode,\r\n      userAgent: req.headers['user-agent'],\r\n      ip: req.ip || req.connection.remoteAddress,\r\n    };\r\n\r\n    if (responseTime) {\r\n      logData.responseTime = `${responseTime}ms`;\r\n    }\r\n\r\n    if (res.statusCode >= 400) {\r\n      logger.warn('API Request', logData);\r\n    } else {\r\n      logger.info('API Request', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log database operation\r\n   */\r\n  database: (operation, query = null, duration = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      duration: duration ? `${duration}ms` : null,\r\n    };\r\n\r\n    if (query) {\r\n      logData.query = typeof query === 'string' ? query : JSON.stringify(query);\r\n    }\r\n\r\n    if (error) {\r\n      logger.error('Database Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('Database Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log file operation\r\n   */\r\n  file: (operation, filePath, size = null, error = null) => {\r\n    const logData = {\r\n      operation,\r\n      filePath,\r\n      size: size ? `${(size / 1024).toFixed(2)}KB` : null,\r\n    };\r\n\r\n    if (error) {\r\n      logger.error('File Operation Failed', { ...logData, error });\r\n    } else {\r\n      logger.debug('File Operation', logData);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log performance metric\r\n   */\r\n  performance: (operation, duration, context = {}) => {\r\n    logger.info('Performance Metric', {\r\n      operation,\r\n      duration: `${duration}ms`,\r\n      ...context,\r\n    });\r\n  },\r\n};\r\n\r\n// Export default logger instance\r\nexport default logger;\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jurit/OneDrive/Desktop/sito%20upscale/lib/errorTracker.js"],"sourcesContent":["/**\r\n * Advanced Error Tracking and Analysis System\r\n * Tracks errors, analyzes patterns, and provides actionable insights\r\n */\r\n\r\nimport { log } from './logger.js';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nconst ERROR_DB_PATH = path.join(process.cwd(), 'logs', 'errors.db.json');\r\n\r\n// Error patterns and solutions database\r\nconst ERROR_PATTERNS = {\r\n  // Database errors\r\n  'ECONNREFUSED': {\r\n    type: 'database',\r\n    severity: 'high',\r\n    solution: 'Check database connection settings and ensure database is running',\r\n    autoFix: false,\r\n  },\r\n  'ETIMEDOUT': {\r\n    type: 'network',\r\n    severity: 'medium',\r\n    solution: 'Check network connectivity and timeout settings',\r\n    autoFix: false,\r\n  },\r\n  'ENOENT': {\r\n    type: 'filesystem',\r\n    severity: 'medium',\r\n    solution: 'File or directory not found. Check file paths and permissions',\r\n    autoFix: true,\r\n  },\r\n  'EACCES': {\r\n    type: 'permission',\r\n    severity: 'high',\r\n    solution: 'Permission denied. Check file/directory permissions',\r\n    autoFix: false,\r\n  },\r\n  'EMFILE': {\r\n    type: 'resource',\r\n    severity: 'high',\r\n    solution: 'Too many open files. Increase ulimit or close file handles',\r\n    autoFix: false,\r\n  },\r\n  'LIMIT_FILE_SIZE': {\r\n    type: 'validation',\r\n    severity: 'low',\r\n    solution: 'File size exceeds limit. Check file size validation',\r\n    autoFix: false,\r\n  },\r\n  'VALIDATION_ERROR': {\r\n    type: 'validation',\r\n    severity: 'low',\r\n    solution: 'Input validation failed. Check input data format',\r\n    autoFix: false,\r\n  },\r\n  'AUTHENTICATION_ERROR': {\r\n    type: 'auth',\r\n    severity: 'medium',\r\n    solution: 'Authentication required. Check user session and tokens',\r\n    autoFix: false,\r\n  },\r\n};\r\n\r\nclass ErrorTracker {\r\n  constructor() {\r\n    this.errorCounts = new Map();\r\n    this.errorHistory = [];\r\n    this.maxHistorySize = 1000;\r\n  }\r\n\r\n  /**\r\n   * Track an error with full context\r\n   */\r\n  async trackError(error, context = {}) {\r\n    const errorInfo = {\r\n      id: this.generateErrorId(),\r\n      timestamp: new Date().toISOString(),\r\n      error: {\r\n        name: error.name,\r\n        message: error.message,\r\n        code: error.code,\r\n        stack: error.stack,\r\n        statusCode: error.statusCode,\r\n      },\r\n      context: {\r\n        ...context,\r\n        environment: process.env.NODE_ENV,\r\n        nodeVersion: process.version,\r\n      },\r\n      pattern: this.analyzeErrorPattern(error),\r\n      frequency: 1,\r\n    };\r\n\r\n    // Update error counts\r\n    const errorKey = this.getErrorKey(error);\r\n    const currentCount = this.errorCounts.get(errorKey) || 0;\r\n    this.errorCounts.set(errorKey, currentCount + 1);\r\n    errorInfo.frequency = currentCount + 1;\r\n\r\n    // Add to history\r\n    this.errorHistory.push(errorInfo);\r\n    if (this.errorHistory.length > this.maxHistorySize) {\r\n      this.errorHistory.shift();\r\n    }\r\n\r\n    // Log error\r\n    log.error('Error Tracked', error, {\r\n      errorId: errorInfo.id,\r\n      pattern: errorInfo.pattern,\r\n      frequency: errorInfo.frequency,\r\n      ...context,\r\n    });\r\n\r\n    // Save to persistent storage\r\n    await this.saveErrorToDB(errorInfo);\r\n\r\n    // Check if error needs immediate attention\r\n    if (this.shouldAlert(errorInfo)) {\r\n      await this.sendAlert(errorInfo);\r\n    }\r\n\r\n    return errorInfo;\r\n  }\r\n\r\n  /**\r\n   * Analyze error pattern and suggest solution\r\n   */\r\n  analyzeErrorPattern(error) {\r\n    const pattern = {\r\n      type: 'unknown',\r\n      severity: 'low',\r\n      solution: null,\r\n      autoFixable: false,\r\n      similarErrors: [],\r\n    };\r\n\r\n    // Check error code\r\n    if (error.code && ERROR_PATTERNS[error.code]) {\r\n      const match = ERROR_PATTERNS[error.code];\r\n      pattern.type = match.type;\r\n      pattern.severity = match.severity;\r\n      pattern.solution = match.solution;\r\n      pattern.autoFixable = match.autoFix;\r\n    }\r\n\r\n    // Check error message for patterns\r\n    if (error.message) {\r\n      const message = error.message.toLowerCase();\r\n      \r\n      if (message.includes('timeout')) {\r\n        pattern.type = 'timeout';\r\n        pattern.severity = 'medium';\r\n        pattern.solution = 'Operation timed out. Consider increasing timeout or optimizing operation';\r\n      } else if (message.includes('memory')) {\r\n        pattern.type = 'memory';\r\n        pattern.severity = 'high';\r\n        pattern.solution = 'Memory issue detected. Check memory usage and optimize';\r\n      } else if (message.includes('permission') || message.includes('access')) {\r\n        pattern.type = 'permission';\r\n        pattern.severity = 'high';\r\n        pattern.solution = 'Permission issue. Check file/directory permissions';\r\n      }\r\n    }\r\n\r\n    // Find similar errors\r\n    pattern.similarErrors = this.findSimilarErrors(error);\r\n\r\n    return pattern;\r\n  }\r\n\r\n  /**\r\n   * Find similar errors in history\r\n   */\r\n  findSimilarErrors(error, limit = 5) {\r\n    return this.errorHistory\r\n      .filter(e => {\r\n        // Similar if same error name or similar message\r\n        return e.error.name === error.name ||\r\n               (e.error.message && error.message && \r\n                this.similarity(e.error.message, error.message) > 0.7);\r\n      })\r\n      .slice(-limit)\r\n      .map(e => ({\r\n        id: e.id,\r\n        timestamp: e.timestamp,\r\n        message: e.error.message,\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * Calculate string similarity (simple Jaccard similarity)\r\n   */\r\n  similarity(str1, str2) {\r\n    const words1 = new Set(str1.toLowerCase().split(/\\s+/));\r\n    const words2 = new Set(str2.toLowerCase().split(/\\s+/));\r\n    const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n    const union = new Set([...words1, ...words2]);\r\n    return intersection.size / union.size;\r\n  }\r\n\r\n  /**\r\n   * Generate unique error ID\r\n   */\r\n  generateErrorId() {\r\n    return `ERR-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  /**\r\n   * Get error key for counting\r\n   */\r\n  getErrorKey(error) {\r\n    return `${error.name || 'Error'}:${error.code || 'NO_CODE'}:${error.message?.substring(0, 50) || 'NO_MESSAGE'}`;\r\n  }\r\n\r\n  /**\r\n   * Check if error should trigger alert\r\n   */\r\n  shouldAlert(errorInfo) {\r\n    // Alert if high severity\r\n    if (errorInfo.pattern.severity === 'high') {\r\n      return true;\r\n    }\r\n\r\n    // Alert if error frequency is high\r\n    if (errorInfo.frequency > 10) {\r\n      return true;\r\n    }\r\n\r\n    // Alert if same error occurred multiple times in short period\r\n    const recentSimilar = this.errorHistory\r\n      .filter(e => \r\n        e.error.name === errorInfo.error.name &&\r\n        new Date(e.timestamp) > new Date(Date.now() - 5 * 60 * 1000) // Last 5 minutes\r\n      ).length;\r\n\r\n    return recentSimilar > 5;\r\n  }\r\n\r\n  /**\r\n   * Send alert for critical errors\r\n   */\r\n  async sendAlert(errorInfo) {\r\n    log.warn('Error Alert Triggered', {\r\n      errorId: errorInfo.id,\r\n      severity: errorInfo.pattern.severity,\r\n      frequency: errorInfo.frequency,\r\n      solution: errorInfo.pattern.solution,\r\n    });\r\n\r\n    // In production, you could send to monitoring service\r\n    // Example: Sentry, PagerDuty, Slack, etc.\r\n    if (process.env.ERROR_ALERT_WEBHOOK) {\r\n      try {\r\n        await fetch(process.env.ERROR_ALERT_WEBHOOK, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            error: errorInfo.error,\r\n            pattern: errorInfo.pattern,\r\n            frequency: errorInfo.frequency,\r\n            timestamp: errorInfo.timestamp,\r\n          }),\r\n        });\r\n      } catch (e) {\r\n        log.error('Failed to send error alert', e);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save error to persistent database\r\n   */\r\n  async saveErrorToDB(errorInfo) {\r\n    try {\r\n      // Ensure logs directory exists\r\n      const logsDir = path.dirname(ERROR_DB_PATH);\r\n      await fs.mkdir(logsDir, { recursive: true });\r\n\r\n      // Read existing errors\r\n      let errors = [];\r\n      try {\r\n        const data = await fs.readFile(ERROR_DB_PATH, 'utf-8');\r\n        errors = JSON.parse(data);\r\n      } catch (e) {\r\n        // File doesn't exist or is invalid, start fresh\r\n      }\r\n\r\n      // Add new error\r\n      errors.push(errorInfo);\r\n\r\n      // Keep only last 10000 errors\r\n      if (errors.length > 10000) {\r\n        errors = errors.slice(-10000);\r\n      }\r\n\r\n      // Write back\r\n      await fs.writeFile(ERROR_DB_PATH, JSON.stringify(errors, null, 2));\r\n    } catch (e) {\r\n      log.error('Failed to save error to DB', e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get error statistics\r\n   */\r\n  getStats() {\r\n    const stats = {\r\n      totalErrors: this.errorHistory.length,\r\n      uniqueErrors: this.errorCounts.size,\r\n      errorsByType: {},\r\n      errorsBySeverity: {},\r\n      recentErrors: this.errorHistory.slice(-10),\r\n      topErrors: Array.from(this.errorCounts.entries())\r\n        .sort((a, b) => b[1] - a[1])\r\n        .slice(0, 10)\r\n        .map(([key, count]) => ({ error: key, count })),\r\n    };\r\n\r\n    // Count by type\r\n    this.errorHistory.forEach(e => {\r\n      const type = e.pattern.type;\r\n      stats.errorsByType[type] = (stats.errorsByType[type] || 0) + 1;\r\n    });\r\n\r\n    // Count by severity\r\n    this.errorHistory.forEach(e => {\r\n      const severity = e.pattern.severity;\r\n      stats.errorsBySeverity[severity] = (stats.errorsBySeverity[severity] || 0) + 1;\r\n    });\r\n\r\n    return stats;\r\n  }\r\n\r\n  /**\r\n   * Get errors by pattern\r\n   */\r\n  getErrorsByPattern(patternType) {\r\n    return this.errorHistory.filter(e => e.pattern.type === patternType);\r\n  }\r\n\r\n  /**\r\n   * Clear error history\r\n   */\r\n  clearHistory() {\r\n    this.errorHistory = [];\r\n    this.errorCounts.clear();\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst errorTracker = new ErrorTracker();\r\n\r\nexport default errorTracker;\r\n\r\n"],"names":[],"mappings":"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"}}]
}