{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jurit/OneDrive/Desktop/sito%20upscale/proxy.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\n\r\n// Enforce canonical host and HTTPS in production\r\n// DISABLED: Relying on Vercel native domain redirects to avoid loops\r\nexport function proxy(request) {\r\n  return NextResponse.next();\r\n}\r\n  \r\n  /* OLD COMPLEX CODE - REMOVED\r\n  // Allow disabling middleware via environment variable\r\n  if (process.env.DISABLE_REDIRECT_MIDDLEWARE === 'true') {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  const url = request.nextUrl.clone();\r\n  const host = request.headers.get('host') || '';\r\n  const hostLower = host.toLowerCase();\r\n  \r\n  // Only run in Vercel production environment\r\n  const vercelEnv = process.env.VERCEL_ENV;\r\n  if (vercelEnv !== 'production') {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Determine primary domain from env\r\n  let envUrl = process.env.NEXT_PUBLIC_URL || process.env.APP_URL || '';\r\n  let primaryHost = '';\r\n  try {\r\n    if (envUrl) {\r\n      // Normalize to HTTPS in production (Vercel always uses HTTPS)\r\n      if (envUrl.startsWith('http://')) {\r\n        envUrl = envUrl.replace('http://', 'https://');\r\n      } else if (!envUrl.startsWith('https://') && !envUrl.startsWith('http://')) {\r\n        // If no protocol specified, assume HTTPS\r\n        envUrl = `https://${envUrl}`;\r\n      }\r\n      const parsedUrl = new URL(envUrl);\r\n      primaryHost = parsedUrl.host.toLowerCase();\r\n      // Remove www. from primaryHost if present to avoid loops\r\n      if (primaryHost.startsWith('www.')) {\r\n        primaryHost = primaryHost.substring(4);\r\n      }\r\n    }\r\n  } catch (e) {\r\n    // Invalid URL, skip redirect\r\n    return NextResponse.next();\r\n  }\r\n  \r\n  // If no primary host configured, skip redirect\r\n  if (!primaryHost || !host) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Normalize current host (remove www. if present for comparison)\r\n  let currentHostNormalized = hostLower;\r\n  if (currentHostNormalized.startsWith('www.')) {\r\n    currentHostNormalized = currentHostNormalized.substring(4);\r\n  }\r\n\r\n  // CRITICAL: If we're already on the correct domain (normalized), NEVER redirect\r\n  if (currentHostNormalized === primaryHost) {\r\n    // Only redirect if current host has www. prefix\r\n    if (hostLower.startsWith('www.')) {\r\n      url.host = primaryHost;\r\n      url.protocol = 'https:';\r\n      // Triple check: ensure target is different and valid\r\n      const targetHost = url.host.toLowerCase();\r\n      if (targetHost && targetHost !== hostLower && targetHost === primaryHost) {\r\n        return NextResponse.redirect(url, 308);\r\n      }\r\n    }\r\n    // Already on correct domain, NO REDIRECT\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Only redirect www to non-www if they're different\r\n  if (hostLower === `www.${primaryHost}` && currentHostNormalized !== primaryHost) {\r\n    url.host = primaryHost;\r\n    url.protocol = 'https:';\r\n    const targetHost = url.host.toLowerCase();\r\n    // Final safety check: target must be different from current\r\n    if (targetHost && targetHost !== hostLower && targetHost === primaryHost) {\r\n      return NextResponse.redirect(url, 308);\r\n    }\r\n  }\r\n\r\n  // Only redirect vercel.app preview URLs if different from primary\r\n  const isVercelHost = hostLower.endsWith('.vercel.app');\r\n  if (isVercelHost && currentHostNormalized !== primaryHost && primaryHost) {\r\n    url.host = primaryHost;\r\n    url.protocol = 'https:';\r\n    const targetHost = url.host.toLowerCase();\r\n    // Final safety check: target must be different from current\r\n    if (targetHost && targetHost !== hostLower && targetHost === primaryHost) {\r\n      return NextResponse.redirect(url, 308);\r\n    }\r\n  }\r\n\r\n  // Default: no redirect\r\n  return NextResponse.next();\r\n  */\r\n\r\nexport const config = {\r\n  matcher: [\r\n    // Run on all routes except Next internals, static assets, and API routes\r\n    // IMPORTANT: Exclude /api/ to prevent interfering with API calls\r\n    // Pattern: match everything except _next, api routes, and static files\r\n    '/((?!api/|_next/static|_next/image|favicon.ico|robots.txt|sitemap.xml).*)',\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAIO,SAAS,MAAM,OAAO;IAC3B,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAgGO,MAAM,SAAS;IACpB,SAAS;QACP,yEAAyE;QACzE,iEAAiE;QACjE,uEAAuE;QACvE;KACD;AACH"}}]
}