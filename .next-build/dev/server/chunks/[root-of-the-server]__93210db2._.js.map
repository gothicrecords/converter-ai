{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jurit/OneDrive/Desktop/sito%20upscale/config/index.js"],"sourcesContent":["/**\r\n * Centralized configuration for the application\r\n * All environment variables and app settings should be defined here\r\n */\r\n\r\nexport const config = {\r\n  // App\r\n  app: {\r\n    name: process.env.APP_NAME || 'Tool Suite',\r\n    env: process.env.NODE_ENV || 'development',\r\n    port: parseInt(process.env.PORT || '3000', 10),\r\n    url: (() => {\r\n      const appUrl = process.env.APP_URL || 'http://localhost:3000';\r\n      // Normalize to HTTPS in production (Vercel always uses HTTPS)\r\n      if (process.env.NODE_ENV === 'production' && appUrl.startsWith('http://')) {\r\n        return appUrl.replace('http://', 'https://');\r\n      }\r\n      return appUrl;\r\n    })(),\r\n  },\r\n\r\n  // Database\r\n  database: {\r\n    url: process.env.DATABASE_URL,\r\n    pool: {\r\n      max: parseInt(process.env.DB_POOL_MAX || '20', 10),\r\n      idleTimeout: parseInt(process.env.DB_IDLE_TIMEOUT || '30000', 10),\r\n      connectionTimeout: parseInt(process.env.DB_CONNECTION_TIMEOUT || '5000', 10),\r\n    },\r\n  },\r\n\r\n  // Supabase\r\n  supabase: {\r\n    url: process.env.NEXT_PUBLIC_SUPABASE_URL,\r\n    anonKey: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\r\n    serviceRoleKey: process.env.SUPABASE_SERVICE_ROLE_KEY,\r\n  },\r\n\r\n  // Stripe\r\n  stripe: {\r\n    secretKey: process.env.STRIPE_SECRET_KEY,\r\n    publishableKey: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,\r\n    webhookSecret: process.env.STRIPE_WEBHOOK_SECRET,\r\n    productId: process.env.STRIPE_PRODUCT_ID || 'prod_TTkHuBeh8iAAht',\r\n  },\r\n\r\n  // Cloudinary\r\n  cloudinary: {\r\n    cloudName: process.env.CLOUDINARY_CLOUD_NAME,\r\n    apiKey: process.env.CLOUDINARY_API_KEY,\r\n    apiSecret: process.env.CLOUDINARY_API_SECRET,\r\n  },\r\n\r\n  // OpenAI\r\n  openai: {\r\n    apiKey: process.env.OPENAI_API_KEY,\r\n  },\r\n\r\n  // File upload\r\n  upload: {\r\n    maxFileSize: parseInt(process.env.MAX_FILE_SIZE || '52428800', 10), // 50MB default\r\n    allowedMimeTypes: {\r\n      image: ['image/jpeg', 'image/png', 'image/webp', 'image/gif', 'image/svg+xml'],\r\n      document: ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],\r\n      video: ['video/mp4', 'video/webm', 'video/ogg'],\r\n      audio: ['audio/mpeg', 'audio/wav', 'audio/ogg'],\r\n    },\r\n    tempDir: process.env.TEMP_DIR || '/tmp',\r\n  },\r\n\r\n  // Session\r\n  session: {\r\n    cookieName: 'megapixelai_session',\r\n    maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\r\n    secret: process.env.SESSION_SECRET || 'change-me-in-production',\r\n  },\r\n\r\n  // Security\r\n  security: {\r\n    bcryptRounds: parseInt(process.env.BCRYPT_ROUNDS || '10', 10),\r\n    rateLimit: {\r\n      windowMs: parseInt(process.env.RATE_LIMIT_WINDOW || '900000', 10), // 15 minutes\r\n      max: parseInt(process.env.RATE_LIMIT_MAX || '100', 10),\r\n    },\r\n  },\r\n\r\n  // Analytics\r\n  analytics: {\r\n    gaTrackingId: process.env.NEXT_PUBLIC_GA_TRACKING_ID,\r\n  },\r\n\r\n  // OAuth\r\n  oauth: {\r\n    google: {\r\n      clientId: process.env.GOOGLE_CLIENT_ID,\r\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n    },\r\n    facebook: {\r\n      appId: process.env.FACEBOOK_APP_ID,\r\n      appSecret: process.env.FACEBOOK_APP_SECRET,\r\n    },\r\n    // Use production domain for OAuth in production, localhost/VERCEL_URL elsewhere\r\n    redirectBaseUrl: (() => {\r\n      // In production environment, use explicit APP_URL or fallback to production domain\r\n      if (process.env.VERCEL_ENV === 'production') {\r\n        return process.env.APP_URL || 'https://megapixelsuite.com';\r\n      }\r\n      // In preview/development, prefer APP_URL, else use VERCEL_URL or localhost\r\n      return process.env.APP_URL || \r\n             (process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : 'http://localhost:3000');\r\n    })(),\r\n  },\r\n};\r\n\r\n// Validation helper\r\nexport function validateConfig() {\r\n  const required = [\r\n    { key: 'database.url', value: config.database.url },\r\n    { key: 'supabase.url', value: config.supabase.url },\r\n    { key: 'supabase.anonKey', value: config.supabase.anonKey },\r\n  ];\r\n\r\n  const missing = required.filter(({ value }) => !value);\r\n  \r\n  if (missing.length > 0) {\r\n    throw new Error(\r\n      `Missing required configuration: ${missing.map(({ key }) => key).join(', ')}`\r\n    );\r\n  }\r\n}\r\n\r\n// Validate on import in production, but do not crash the app.\r\n// Use STRICT_CONFIG=true to enforce hard failures.\r\nif (config.app.env === 'production') {\r\n  const strict = process.env.STRICT_CONFIG === 'true';\r\n  try {\r\n    validateConfig();\r\n  } catch (e) {\r\n    if (strict) {\r\n      throw e;\r\n    } else {\r\n      // Log a clear warning and continue running to avoid site-wide downtime\r\n      console.error('[Config Warning] Missing required configuration:', e.message);\r\n    }\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 184, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jurit/OneDrive/Desktop/sito%20upscale/pages/api/auth/oauth/google/index.js"],"sourcesContent":["import { config } from '../../../../../config';\r\nimport crypto from 'crypto';\r\n\r\n/**\r\n * Initiate Google OAuth flow\r\n * Redirects user to Google consent screen with state token for CSRF protection\r\n */\r\nexport default async function googleOAuthInitHandler(req, res) {\r\n  // Only allow GET requests\r\n  if (req.method !== 'GET') {\r\n    return res.status(405).redirect('/login?error=' + encodeURIComponent('Method not allowed'));\r\n  }\r\n\r\n  try {\r\n    // Check OAuth configuration\r\n    const { clientId } = config.oauth.google || {};\r\n    if (!clientId) {\r\n      console.error('Google OAuth client ID not configured');\r\n      return res.redirect('/login?error=' + encodeURIComponent('OAuth not configured'));\r\n    }\r\n\r\n    const redirectUri = `${config.oauth.redirectBaseUrl}/api/auth/oauth/google/callback`;\r\n\r\n    // Generate and store state token for CSRF protection\r\n    const state = crypto.randomBytes(32).toString('hex');\r\n    \r\n    // Set state cookie (expires in 10 minutes)\r\n    res.setHeader('Set-Cookie', `oauth_state=${state}; HttpOnly; SameSite=Lax; Path=/; Max-Age=600`);\r\n\r\n    // Build Google OAuth URL\r\n    const googleAuthUrl = new URL('https://accounts.google.com/o/oauth2/v2/auth');\r\n    googleAuthUrl.searchParams.set('client_id', clientId);\r\n    googleAuthUrl.searchParams.set('redirect_uri', redirectUri);\r\n    googleAuthUrl.searchParams.set('response_type', 'code');\r\n    googleAuthUrl.searchParams.set('scope', 'openid email profile');\r\n    googleAuthUrl.searchParams.set('state', state);\r\n    googleAuthUrl.searchParams.set('access_type', 'online');\r\n    googleAuthUrl.searchParams.set('prompt', 'select_account');\r\n\r\n    console.log('Redirecting to Google OAuth:', {\r\n      clientId: clientId.substring(0, 20) + '...',\r\n      redirectUri,\r\n      state: state.substring(0, 16) + '...'\r\n    });\r\n\r\n    // Redirect to Google\r\n    return res.redirect(googleAuthUrl.toString());\r\n  } catch (error) {\r\n    console.error('Google OAuth init error:', error);\r\n    return res.redirect('/login?error=' + encodeURIComponent('Failed to initiate OAuth'));\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAMe,eAAe,uBAAuB,GAAG,EAAE,GAAG;IAC3D,0BAA0B;IAC1B,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,QAAQ,CAAC,kBAAkB,mBAAmB;IACvE;IAEA,IAAI;QACF,4BAA4B;QAC5B,MAAM,EAAE,QAAQ,EAAE,GAAG,kHAAM,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC;QAC7C,IAAI,CAAC,UAAU;YACb,QAAQ,KAAK,CAAC;YACd,OAAO,IAAI,QAAQ,CAAC,kBAAkB,mBAAmB;QAC3D;QAEA,MAAM,cAAc,GAAG,kHAAM,CAAC,KAAK,CAAC,eAAe,CAAC,+BAA+B,CAAC;QAEpF,qDAAqD;QACrD,MAAM,QAAQ,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;QAE9C,2CAA2C;QAC3C,IAAI,SAAS,CAAC,cAAc,CAAC,YAAY,EAAE,MAAM,6CAA6C,CAAC;QAE/F,yBAAyB;QACzB,MAAM,gBAAgB,IAAI,IAAI;QAC9B,cAAc,YAAY,CAAC,GAAG,CAAC,aAAa;QAC5C,cAAc,YAAY,CAAC,GAAG,CAAC,gBAAgB;QAC/C,cAAc,YAAY,CAAC,GAAG,CAAC,iBAAiB;QAChD,cAAc,YAAY,CAAC,GAAG,CAAC,SAAS;QACxC,cAAc,YAAY,CAAC,GAAG,CAAC,SAAS;QACxC,cAAc,YAAY,CAAC,GAAG,CAAC,eAAe;QAC9C,cAAc,YAAY,CAAC,GAAG,CAAC,UAAU;QAEzC,QAAQ,GAAG,CAAC,gCAAgC;YAC1C,UAAU,SAAS,SAAS,CAAC,GAAG,MAAM;YACtC;YACA,OAAO,MAAM,SAAS,CAAC,GAAG,MAAM;QAClC;QAEA,qBAAqB;QACrB,OAAO,IAAI,QAAQ,CAAC,cAAc,QAAQ;IAC5C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,IAAI,QAAQ,CAAC,kBAAkB,mBAAmB;IAC3D;AACF"}}]
}