{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jurit/OneDrive/Desktop/sito%20upscale/lib/openai.js"],"sourcesContent":["// OpenAI API integration with official SDK\r\nimport OpenAI from 'openai';\r\n\r\nconst openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\n// Generate embeddings for text\r\nexport async function generateEmbedding(text) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  try {\r\n    const response = await openai.embeddings.create({\r\n      model: 'text-embedding-3-small',\r\n      input: text.substring(0, 8000), // Limit input size\r\n    });\r\n\r\n    return response.data[0].embedding;\r\n  } catch (error) {\r\n    console.error('Error generating embedding:', error);\r\n    throw new Error(`Failed to generate embedding: ${error.message}`);\r\n  }\r\n}\r\n\r\n// Generate embeddings in batch for an array of texts\r\nexport async function generateEmbeddingsBatch(texts) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  if (!Array.isArray(texts) || texts.length === 0) return [];\r\n\r\n  try {\r\n    const response = await openai.embeddings.create({\r\n      model: 'text-embedding-3-small',\r\n      input: texts.map(t => (t || '').toString().substring(0, 8000)),\r\n    });\r\n\r\n    return response.data.map(d => d.embedding);\r\n  } catch (error) {\r\n    console.error('Error generating batch embeddings:', error);\r\n    throw new Error(`Failed to generate batch embeddings: ${error.message}`);\r\n  }\r\n}\r\n\r\n// Chat completion using OpenAI GPT models\r\nexport async function chatCompletion(messages, options = {}) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  try {\r\n    const response = await openai.chat.completions.create({\r\n      model: options.model || 'gpt-4o-mini', // Fast and affordable\r\n      messages: messages,\r\n      temperature: options.temperature || 0.7,\r\n      max_tokens: options.max_tokens || 1000,\r\n      top_p: options.top_p || 1,\r\n      frequency_penalty: options.frequency_penalty || 0,\r\n      presence_penalty: options.presence_penalty || 0,\r\n    });\r\n\r\n    return response.choices[0].message.content;\r\n  } catch (error) {\r\n    console.error('Error in chat completion:', error);\r\n    \r\n    // Handle specific OpenAI errors\r\n    if (error.status === 401) {\r\n      throw new Error('Chiave API OpenAI non valida. Verifica la configurazione.');\r\n    } else if (error.status === 429) {\r\n      throw new Error('Limite di rate raggiunto. Riprova tra qualche secondo.');\r\n    } else if (error.status === 500) {\r\n      throw new Error('Errore del server OpenAI. Riprova più tardi.');\r\n    }\r\n    \r\n    throw new Error(`Errore nella comunicazione con OpenAI: ${error.message}`);\r\n  }\r\n}\r\n\r\n// Generate summary\r\nexport async function generateSummary(text, maxLength = 200) {\r\n  const messages = [\r\n    {\r\n      role: 'system',\r\n      content: 'You are a helpful assistant that creates concise summaries.',\r\n    },\r\n    {\r\n      role: 'user',\r\n      content: `Summarize the following text in ${maxLength} words or less:\\n\\n${text}`,\r\n    },\r\n  ];\r\n\r\n  return await chatCompletion(messages, { temperature: 0.5, max_tokens: 300 });\r\n}\r\n\r\n// Generate tags\r\nexport async function generateTags(text, count = 5) {\r\n  const messages = [\r\n    {\r\n      role: 'system',\r\n      content: 'You are a helpful assistant that generates relevant tags for documents. Return only comma-separated tags, no explanations.',\r\n    },\r\n    {\r\n      role: 'user',\r\n      content: `Generate ${count} relevant tags for this document:\\n\\n${text.substring(0, 2000)}`,\r\n    },\r\n  ];\r\n\r\n  const response = await chatCompletion(messages, { temperature: 0.3, max_tokens: 100 });\r\n  \r\n  return response\r\n    .split(',')\r\n    .map(tag => tag.trim().toLowerCase())\r\n    .filter(tag => tag.length > 0)\r\n    .slice(0, count);\r\n}\r\n\r\n// Classify document\r\nexport async function classifyDocument(text) {\r\n  const categories = [\r\n    'contract', 'invoice', 'report', 'presentation', \r\n    'spreadsheet', 'image', 'code', 'email', 'article', 'other'\r\n  ];\r\n\r\n  const messages = [\r\n    {\r\n      role: 'system',\r\n      content: `You are a document classifier. Classify the document into one or more of these categories: ${categories.join(', ')}. Return only category names, comma-separated.`,\r\n    },\r\n    {\r\n      role: 'user',\r\n      content: `Classify this document:\\n\\n${text.substring(0, 1000)}`,\r\n    },\r\n  ];\r\n\r\n  const response = await chatCompletion(messages, { temperature: 0.2, max_tokens: 50 });\r\n  \r\n  return response\r\n    .split(',')\r\n    .map(cat => cat.trim().toLowerCase())\r\n    .filter(cat => categories.includes(cat));\r\n}\r\n\r\n// Vision API - Analizza immagini come ChatGPT\r\nexport async function analyzeImageWithVision(imageBuffer, imageMimeType, query = 'Cosa contiene questa immagine? Descrivi tutto ciò che vedi.') {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  try {\r\n    // Converti il buffer in base64\r\n    const base64Image = imageBuffer.toString('base64');\r\n    \r\n    const response = await openai.chat.completions.create({\r\n      model: 'gpt-4o', // GPT-4o supporta vision\r\n      messages: [\r\n        {\r\n          role: 'system',\r\n          content: 'Sei un assistente AI esperto nell\\'analisi di immagini. Descrivi in dettaglio tutto ciò che vedi nell\\'immagine, inclusi testo, oggetti, persone, scene, colori e qualsiasi altro dettaglio rilevante. Rispondi sempre in italiano.'\r\n        },\r\n        {\r\n          role: 'user',\r\n          content: [\r\n            {\r\n              type: 'text',\r\n              text: query\r\n            },\r\n            {\r\n              type: 'image_url',\r\n              image_url: {\r\n                url: `data:${imageMimeType};base64,${base64Image}`,\r\n                detail: 'high'\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      ],\r\n      max_tokens: 2000,\r\n      temperature: 0.2\r\n    });\r\n\r\n    return response.choices[0].message.content;\r\n  } catch (error) {\r\n    console.error('Error in vision API:', error);\r\n    \r\n    if (error.status === 401) {\r\n      throw new Error('Chiave API OpenAI non valida. Verifica la configurazione.');\r\n    } else if (error.status === 429) {\r\n      throw new Error('Limite di rate raggiunto. Riprova tra qualche secondo.');\r\n    } else if (error.status === 400 && error.message?.includes('image')) {\r\n      throw new Error('Formato immagine non supportato o immagine troppo grande.');\r\n    }\r\n    \r\n    throw new Error(`Errore nell'analisi dell'immagine: ${error.message}`);\r\n  }\r\n}\r\n\r\n// Estrazione testo da PDF con OpenAI Responses API (gpt-4o) usando input_file\r\n// Ritorna SOLO la stringa di testo estratto (no IDs, no oggetti)\r\nexport async function extractTextFromPdfWithOpenAI(filePath) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  const fs = await import('fs');\r\n  \r\n  let uploadedFile = null;\r\n  try {\r\n    console.log('Caricamento PDF su OpenAI (Responses API):', filePath);\r\n    \r\n    // 1) Carica il file su OpenAI come user_data\r\n    uploadedFile = await openai.files.create({\r\n      file: fs.createReadStream(filePath),\r\n      purpose: 'user_data'\r\n    });\r\n\r\n    console.log('File caricato su OpenAI:', uploadedFile.id);\r\n\r\n    // 2) Richiesta al modello GPT-4o per estrazione testo dal file caricato\r\n    const response = await openai.responses.create({\r\n      model: 'gpt-4o',\r\n      input: [\r\n        {\r\n          role: 'user',\r\n          content: [\r\n            { type: 'input_text', text: 'Estrai tutto il testo e le informazioni rilevanti da questo documento. Rispondi SOLO con il testo estratto, senza commenti.' },\r\n            { type: 'input_file', file_id: uploadedFile.id }\r\n          ]\r\n        }\r\n      ],\r\n      max_output_tokens: 8000,\r\n      temperature: 0.1\r\n    });\r\n\r\n    // 3) Prendi solo testo\r\n    const extractedText = (response.output_text || '').toString().trim();\r\n    console.log(`Testo estratto da PDF: ${extractedText.length} caratteri`);\r\n    \r\n    if (!extractedText) {\r\n      throw new Error('Nessun testo estratto dal PDF');\r\n    }\r\n\r\n    return extractedText;\r\n\r\n  } catch (error) {\r\n    console.error('Error in PDF text extraction (Responses API):', error);\r\n    \r\n    if (error.status === 401) {\r\n      throw new Error('Chiave API OpenAI non valida. Verifica la configurazione.');\r\n    } else if (error.status === 429) {\r\n      throw new Error('Limite di rate raggiunto. Riprova tra qualche secondo.');\r\n    } else if (error.status === 400) {\r\n      throw new Error('Errore nell\\'analisi del PDF con Responses API. Il file potrebbe essere troppo grande o danneggiato.');\r\n    }\r\n    \r\n    throw new Error(`Errore nell'estrazione del testo PDF: ${error.message}`);\r\n  } finally {\r\n    // 4) Prova a rimuovere il file caricato (se l'SDK lo supporta)\r\n    try {\r\n      if (uploadedFile && uploadedFile.id) {\r\n        if (openai.files?.delete) {\r\n          await openai.files.delete(uploadedFile.id);\r\n        } else if (openai.files?.del) {\r\n          await openai.files.del(uploadedFile.id);\r\n        }\r\n        console.log('File rimosso da OpenAI:', uploadedFile.id);\r\n      }\r\n    } catch (delError) {\r\n      console.warn('Errore rimozione file da OpenAI (ignorato):', delError?.message || delError);\r\n    }\r\n  }\r\n}\r\n\r\n// DALL-E 3 - Get image URL only (faster, for streaming)\r\nexport async function getImageUrlFromDALLE(prompt, options = {}) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  try {\r\n    const size = options.size || '1024x1024';\r\n    const quality = options.quality || 'standard';\r\n    const style = options.style || 'vivid';\r\n\r\n    const response = await openai.images.generate({\r\n      model: 'dall-e-3',\r\n      prompt: prompt,\r\n      size: size,\r\n      quality: quality,\r\n      style: style,\r\n      n: 1,\r\n    });\r\n\r\n    const imageUrl = response.data[0]?.url;\r\n    if (!imageUrl) {\r\n      throw new Error('Nessuna immagine generata da DALL-E');\r\n    }\r\n\r\n    return imageUrl;\r\n  } catch (error) {\r\n    console.error('Error getting image URL from DALL-E:', error);\r\n    console.error('Error details:', {\r\n      status: error.status,\r\n      statusText: error.statusText,\r\n      message: error.message,\r\n      code: error.code,\r\n      response: error.response?.data || error.response\r\n    });\r\n    \r\n    if (error.status === 401) {\r\n      throw new Error('Chiave API OpenAI non valida. Verifica la configurazione.');\r\n    } else if (error.status === 429) {\r\n      throw new Error('Limite di rate raggiunto. Riprova tra qualche secondo.');\r\n    } else if (error.status === 400) {\r\n      const errorMessage = error.message || error.response?.data?.error?.message || 'Prompt non valido o contenuto non consentito';\r\n      throw new Error(`Errore nella generazione: ${errorMessage}`);\r\n    } else if (error.code === 'ENOTFOUND' || error.code === 'ECONNREFUSED') {\r\n      throw new Error('Errore di connessione con OpenAI. Verifica la tua connessione internet.');\r\n    }\r\n    \r\n    throw new Error(`Errore nella generazione dell'immagine: ${error.message || 'Errore sconosciuto'}`);\r\n  }\r\n}\r\n\r\n// DALL-E 3 - Generazione immagini (download completo, per backward compatibility)\r\nexport async function generateImageWithDALLE(prompt, options = {}) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  try {\r\n    const imageUrl = await getImageUrlFromDALLE(prompt, options);\r\n\r\n    // Download the image and return as buffer\r\n    const imageResponse = await fetch(imageUrl);\r\n    if (!imageResponse.ok) {\r\n      const errorText = await imageResponse.text().catch(() => 'Unknown error');\r\n      throw new Error(`Errore nel download dell'immagine generata: ${imageResponse.status} ${imageResponse.statusText}. ${errorText}`);\r\n    }\r\n\r\n    const arrayBuffer = await imageResponse.arrayBuffer();\r\n    return Buffer.from(arrayBuffer);\r\n  } catch (error) {\r\n    // Re-throw errors from getImageUrlFromDALLE\r\n    throw error;\r\n  }\r\n}\r\n\r\n// DALL-E 3 - Upscale/Miglioramento immagine usando variante\r\nexport async function upscaleImageWithDALLE(imageBuffer, imageMimeType, enhancementPrompt = null) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  try {\r\n    // 1. Analizza l'immagine con Vision API per creare un prompt descrittivo\r\n    const analysisPrompt = enhancementPrompt || 'Descrivi in dettaglio questa immagine, includendo tutti i dettagli visivi, colori, composizione, stile e qualità. La descrizione sarà usata per creare una versione migliorata ad alta risoluzione.';\r\n    \r\n    const imageDescription = await analyzeImageWithVision(\r\n      imageBuffer, \r\n      imageMimeType, \r\n      analysisPrompt\r\n    );\r\n\r\n    // 2. Crea un prompt per DALL-E che migliora l'immagine\r\n    const enhancementPromptText = `Crea una versione migliorata e ad alta risoluzione di questa immagine: ${imageDescription}. Mantieni fedeltà ai dettagli originali ma migliora la qualità, la nitidezza e la risoluzione.`;\r\n\r\n    // 3. Genera immagine migliorata con DALL-E 3 in alta risoluzione\r\n    const enhancedImageBuffer = await generateImageWithDALLE(enhancementPromptText, {\r\n      size: '1792x1024', // Formato landscape per alta risoluzione\r\n      quality: 'hd',\r\n      style: 'natural'\r\n    });\r\n\r\n    return enhancedImageBuffer;\r\n  } catch (error) {\r\n    console.error('Error upscaling image with DALL-E:', error);\r\n    throw new Error(`Errore nel miglioramento dell'immagine: ${error.message}`);\r\n  }\r\n}\r\n\r\n// Enhance existing image quality using AI analysis + sharp processing\r\nexport async function enhanceImageQualityWithAI(imageBuffer, imageMimeType) {\r\n  if (!process.env.OPENAI_API_KEY) {\r\n    throw new Error('OPENAI_API_KEY is not configured. Please set it in your environment variables.');\r\n  }\r\n\r\n  try {\r\n    // Use Vision API to analyze image quality issues\r\n    const analysisPrompt = `Analyze this image and identify specific quality issues that need improvement. Focus on:\r\n1. Noise level (low/medium/high)\r\n2. Sharpness (blurry/sharp)\r\n3. Color accuracy (washed out/vibrant)\r\n4. Artifacts (compression artifacts, pixelation)\r\n5. Overall quality issues\r\n\r\nRespond with a JSON object: {\"noise\": \"low|medium|high\", \"sharpness\": \"blurry|moderate|sharp\", \"color\": \"washed|normal|vibrant\", \"artifacts\": \"none|minor|major\", \"recommendations\": \"brief description\"}`;\r\n    \r\n    const analysisResult = await analyzeImageWithVision(\r\n      imageBuffer, \r\n      imageMimeType, \r\n      analysisPrompt\r\n    );\r\n\r\n    // Parse analysis result\r\n    let analysis = {\r\n      noise: 'medium',\r\n      sharpness: 'moderate',\r\n      color: 'normal',\r\n      artifacts: 'none'\r\n    };\r\n\r\n    try {\r\n      // Try to parse JSON from analysis\r\n      const jsonMatch = analysisResult.match(/\\{[\\s\\S]*\\}/);\r\n      if (jsonMatch) {\r\n        const parsed = JSON.parse(jsonMatch[0]);\r\n        analysis = { ...analysis, ...parsed };\r\n      }\r\n    } catch (parseError) {\r\n      console.warn('Could not parse AI analysis, using defaults');\r\n    }\r\n\r\n    // Apply targeted enhancements using sharp based on AI analysis\r\n    const sharp = (await import('sharp')).default;\r\n    let enhanced = sharp(imageBuffer, { sequentialRead: true });\r\n\r\n    // Apply denoising if needed\r\n    if (analysis.noise === 'high' || analysis.noise === 'medium') {\r\n      enhanced = enhanced.median(analysis.noise === 'high' ? 3 : 2);\r\n    }\r\n\r\n    // Apply sharpening based on analysis\r\n    if (analysis.sharpness === 'blurry') {\r\n      enhanced = enhanced.sharpen({\r\n        sigma: 2.0,\r\n        m1: 1.0,\r\n        m2: 0.5,\r\n        x1: 3,\r\n        y2: 3,\r\n        y3: 3\r\n      });\r\n    } else if (analysis.sharpness === 'moderate') {\r\n      enhanced = enhanced.sharpen({\r\n        sigma: 1.0,\r\n        m1: 0.7,\r\n        m2: 0.4\r\n      });\r\n    }\r\n\r\n    // Enhance color if needed\r\n    if (analysis.color === 'washed') {\r\n      enhanced = enhanced.modulate({\r\n        saturation: 1.15,\r\n        brightness: 1.05\r\n      }).linear(1.05, -(128 * 0.05)); // Slight contrast boost\r\n    }\r\n\r\n    // Remove compression artifacts\r\n    if (analysis.artifacts === 'major' || analysis.artifacts === 'minor') {\r\n      enhanced = enhanced.png({\r\n        quality: 100,\r\n        compressionLevel: 6,\r\n        adaptiveFiltering: true\r\n      });\r\n    } else {\r\n      // Keep original format but with high quality\r\n      if (imageMimeType === 'image/jpeg' || imageMimeType === 'image/jpg') {\r\n        enhanced = enhanced.jpeg({\r\n          quality: 98,\r\n          mozjpeg: true,\r\n          trellisQuantisation: true,\r\n          overshootDeringing: true\r\n        });\r\n      } else {\r\n        enhanced = enhanced.png({\r\n          quality: 100,\r\n          compressionLevel: 6\r\n        });\r\n      }\r\n    }\r\n\r\n    const enhancedBuffer = await enhanced.toBuffer();\r\n    return enhancedBuffer;\r\n  } catch (error) {\r\n    console.error('Error enhancing image quality with AI:', error);\r\n    // Return original buffer if enhancement fails\r\n    return imageBuffer;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,2CAA2C;;;;;;;;;;;;;;;;;;;;;;;;;;;AAC3C;;;;;;AAEA,MAAM,SAAS,IAAI,uHAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAGO,eAAe,kBAAkB,IAAI;IAC1C,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,UAAU,CAAC,MAAM,CAAC;YAC9C,OAAO;YACP,OAAO,KAAK,SAAS,CAAC,GAAG;QAC3B;QAEA,OAAO,SAAS,IAAI,CAAC,EAAE,CAAC,SAAS;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,MAAM,OAAO,EAAE;IAClE;AACF;AAGO,eAAe,wBAAwB,KAAK;IACjD,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,MAAM,OAAO,CAAC,UAAU,MAAM,MAAM,KAAK,GAAG,OAAO,EAAE;IAE1D,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,UAAU,CAAC,MAAM,CAAC;YAC9C,OAAO;YACP,OAAO,MAAM,GAAG,CAAC,CAAA,IAAK,CAAC,KAAK,EAAE,EAAE,QAAQ,GAAG,SAAS,CAAC,GAAG;QAC1D;QAEA,OAAO,SAAS,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,SAAS;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM,IAAI,MAAM,CAAC,qCAAqC,EAAE,MAAM,OAAO,EAAE;IACzE;AACF;AAGO,eAAe,eAAe,QAAQ,EAAE,UAAU,CAAC,CAAC;IACzD,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO,QAAQ,KAAK,IAAI;YACxB,UAAU;YACV,aAAa,QAAQ,WAAW,IAAI;YACpC,YAAY,QAAQ,UAAU,IAAI;YAClC,OAAO,QAAQ,KAAK,IAAI;YACxB,mBAAmB,QAAQ,iBAAiB,IAAI;YAChD,kBAAkB,QAAQ,gBAAgB,IAAI;QAChD;QAEA,OAAO,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;IAC5C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAE3C,gCAAgC;QAChC,IAAI,MAAM,MAAM,KAAK,KAAK;YACxB,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,KAAK;YAC/B,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,KAAK;YAC/B,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,IAAI,MAAM,CAAC,uCAAuC,EAAE,MAAM,OAAO,EAAE;IAC3E;AACF;AAGO,eAAe,gBAAgB,IAAI,EAAE,YAAY,GAAG;IACzD,MAAM,WAAW;QACf;YACE,MAAM;YACN,SAAS;QACX;QACA;YACE,MAAM;YACN,SAAS,CAAC,gCAAgC,EAAE,UAAU,mBAAmB,EAAE,MAAM;QACnF;KACD;IAED,OAAO,MAAM,eAAe,UAAU;QAAE,aAAa;QAAK,YAAY;IAAI;AAC5E;AAGO,eAAe,aAAa,IAAI,EAAE,QAAQ,CAAC;IAChD,MAAM,WAAW;QACf;YACE,MAAM;YACN,SAAS;QACX;QACA;YACE,MAAM;YACN,SAAS,CAAC,SAAS,EAAE,MAAM,qCAAqC,EAAE,KAAK,SAAS,CAAC,GAAG,OAAO;QAC7F;KACD;IAED,MAAM,WAAW,MAAM,eAAe,UAAU;QAAE,aAAa;QAAK,YAAY;IAAI;IAEpF,OAAO,SACJ,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,MAAO,IAAI,IAAI,GAAG,WAAW,IACjC,MAAM,CAAC,CAAA,MAAO,IAAI,MAAM,GAAG,GAC3B,KAAK,CAAC,GAAG;AACd;AAGO,eAAe,iBAAiB,IAAI;IACzC,MAAM,aAAa;QACjB;QAAY;QAAW;QAAU;QACjC;QAAe;QAAS;QAAQ;QAAS;QAAW;KACrD;IAED,MAAM,WAAW;QACf;YACE,MAAM;YACN,SAAS,CAAC,2FAA2F,EAAE,WAAW,IAAI,CAAC,MAAM,8CAA8C,CAAC;QAC9K;QACA;YACE,MAAM;YACN,SAAS,CAAC,2BAA2B,EAAE,KAAK,SAAS,CAAC,GAAG,OAAO;QAClE;KACD;IAED,MAAM,WAAW,MAAM,eAAe,UAAU;QAAE,aAAa;QAAK,YAAY;IAAG;IAEnF,OAAO,SACJ,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,MAAO,IAAI,IAAI,GAAG,WAAW,IACjC,MAAM,CAAC,CAAA,MAAO,WAAW,QAAQ,CAAC;AACvC;AAGO,eAAe,uBAAuB,WAAW,EAAE,aAAa,EAAE,QAAQ,6DAA6D;IAC5I,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,+BAA+B;QAC/B,MAAM,cAAc,YAAY,QAAQ,CAAC;QAEzC,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;gBACR;oBACE,MAAM;oBACN,SAAS;gBACX;gBACA;oBACE,MAAM;oBACN,SAAS;wBACP;4BACE,MAAM;4BACN,MAAM;wBACR;wBACA;4BACE,MAAM;4BACN,WAAW;gCACT,KAAK,CAAC,KAAK,EAAE,cAAc,QAAQ,EAAE,aAAa;gCAClD,QAAQ;4BACV;wBACF;qBACD;gBACH;aACD;YACD,YAAY;YACZ,aAAa;QACf;QAEA,OAAO,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;IAC5C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QAEtC,IAAI,MAAM,MAAM,KAAK,KAAK;YACxB,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,KAAK;YAC/B,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,OAAO,MAAM,OAAO,EAAE,SAAS,UAAU;YACnE,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,IAAI,MAAM,CAAC,mCAAmC,EAAE,MAAM,OAAO,EAAE;IACvE;AACF;AAIO,eAAe,6BAA6B,QAAQ;IACzD,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,KAAK;IAEX,IAAI,eAAe;IACnB,IAAI;QACF,QAAQ,GAAG,CAAC,8CAA8C;QAE1D,6CAA6C;QAC7C,eAAe,MAAM,OAAO,KAAK,CAAC,MAAM,CAAC;YACvC,MAAM,GAAG,gBAAgB,CAAC;YAC1B,SAAS;QACX;QAEA,QAAQ,GAAG,CAAC,4BAA4B,aAAa,EAAE;QAEvD,wEAAwE;QACxE,MAAM,WAAW,MAAM,OAAO,SAAS,CAAC,MAAM,CAAC;YAC7C,OAAO;YACP,OAAO;gBACL;oBACE,MAAM;oBACN,SAAS;wBACP;4BAAE,MAAM;4BAAc,MAAM;wBAA8H;wBAC1J;4BAAE,MAAM;4BAAc,SAAS,aAAa,EAAE;wBAAC;qBAChD;gBACH;aACD;YACD,mBAAmB;YACnB,aAAa;QACf;QAEA,uBAAuB;QACvB,MAAM,gBAAgB,CAAC,SAAS,WAAW,IAAI,EAAE,EAAE,QAAQ,GAAG,IAAI;QAClE,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,cAAc,MAAM,CAAC,UAAU,CAAC;QAEtE,IAAI,CAAC,eAAe;YAClB,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iDAAiD;QAE/D,IAAI,MAAM,MAAM,KAAK,KAAK;YACxB,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,KAAK;YAC/B,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,KAAK;YAC/B,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,IAAI,MAAM,CAAC,sCAAsC,EAAE,MAAM,OAAO,EAAE;IAC1E,SAAU;QACR,+DAA+D;QAC/D,IAAI;YACF,IAAI,gBAAgB,aAAa,EAAE,EAAE;gBACnC,IAAI,OAAO,KAAK,EAAE,QAAQ;oBACxB,MAAM,OAAO,KAAK,CAAC,MAAM,CAAC,aAAa,EAAE;gBAC3C,OAAO,IAAI,OAAO,KAAK,EAAE,KAAK;oBAC5B,MAAM,OAAO,KAAK,CAAC,GAAG,CAAC,aAAa,EAAE;gBACxC;gBACA,QAAQ,GAAG,CAAC,2BAA2B,aAAa,EAAE;YACxD;QACF,EAAE,OAAO,UAAU;YACjB,QAAQ,IAAI,CAAC,+CAA+C,UAAU,WAAW;QACnF;IACF;AACF;AAGO,eAAe,qBAAqB,MAAM,EAAE,UAAU,CAAC,CAAC;IAC7D,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,OAAO,QAAQ,IAAI,IAAI;QAC7B,MAAM,UAAU,QAAQ,OAAO,IAAI;QACnC,MAAM,QAAQ,QAAQ,KAAK,IAAI;QAE/B,MAAM,WAAW,MAAM,OAAO,MAAM,CAAC,QAAQ,CAAC;YAC5C,OAAO;YACP,QAAQ;YACR,MAAM;YACN,SAAS;YACT,OAAO;YACP,GAAG;QACL;QAEA,MAAM,WAAW,SAAS,IAAI,CAAC,EAAE,EAAE;QACnC,IAAI,CAAC,UAAU;YACb,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,QAAQ,KAAK,CAAC,kBAAkB;YAC9B,QAAQ,MAAM,MAAM;YACpB,YAAY,MAAM,UAAU;YAC5B,SAAS,MAAM,OAAO;YACtB,MAAM,MAAM,IAAI;YAChB,UAAU,MAAM,QAAQ,EAAE,QAAQ,MAAM,QAAQ;QAClD;QAEA,IAAI,MAAM,MAAM,KAAK,KAAK;YACxB,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,KAAK;YAC/B,MAAM,IAAI,MAAM;QAClB,OAAO,IAAI,MAAM,MAAM,KAAK,KAAK;YAC/B,MAAM,eAAe,MAAM,OAAO,IAAI,MAAM,QAAQ,EAAE,MAAM,OAAO,WAAW;YAC9E,MAAM,IAAI,MAAM,CAAC,0BAA0B,EAAE,cAAc;QAC7D,OAAO,IAAI,MAAM,IAAI,KAAK,eAAe,MAAM,IAAI,KAAK,gBAAgB;YACtE,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,IAAI,MAAM,CAAC,wCAAwC,EAAE,MAAM,OAAO,IAAI,sBAAsB;IACpG;AACF;AAGO,eAAe,uBAAuB,MAAM,EAAE,UAAU,CAAC,CAAC;IAC/D,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,qBAAqB,QAAQ;QAEpD,0CAA0C;QAC1C,MAAM,gBAAgB,MAAM,MAAM;QAClC,IAAI,CAAC,cAAc,EAAE,EAAE;YACrB,MAAM,YAAY,MAAM,cAAc,IAAI,GAAG,KAAK,CAAC,IAAM;YACzD,MAAM,IAAI,MAAM,CAAC,4CAA4C,EAAE,cAAc,MAAM,CAAC,CAAC,EAAE,cAAc,UAAU,CAAC,EAAE,EAAE,WAAW;QACjI;QAEA,MAAM,cAAc,MAAM,cAAc,WAAW;QACnD,OAAO,OAAO,IAAI,CAAC;IACrB,EAAE,OAAO,OAAO;QACd,4CAA4C;QAC5C,MAAM;IACR;AACF;AAGO,eAAe,sBAAsB,WAAW,EAAE,aAAa,EAAE,oBAAoB,IAAI;IAC9F,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,yEAAyE;QACzE,MAAM,iBAAiB,qBAAqB;QAE5C,MAAM,mBAAmB,MAAM,uBAC7B,aACA,eACA;QAGF,uDAAuD;QACvD,MAAM,wBAAwB,CAAC,uEAAuE,EAAE,iBAAiB,+FAA+F,CAAC;QAEzN,iEAAiE;QACjE,MAAM,sBAAsB,MAAM,uBAAuB,uBAAuB;YAC9E,MAAM;YACN,SAAS;YACT,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM,IAAI,MAAM,CAAC,wCAAwC,EAAE,MAAM,OAAO,EAAE;IAC5E;AACF;AAGO,eAAe,0BAA0B,WAAW,EAAE,aAAa;IACxE,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,iDAAiD;QACjD,MAAM,iBAAiB,CAAC;;;;;;;yMAO6K,CAAC;QAEtM,MAAM,iBAAiB,MAAM,uBAC3B,aACA,eACA;QAGF,wBAAwB;QACxB,IAAI,WAAW;YACb,OAAO;YACP,WAAW;YACX,OAAO;YACP,WAAW;QACb;QAEA,IAAI;YACF,kCAAkC;YAClC,MAAM,YAAY,eAAe,KAAK,CAAC;YACvC,IAAI,WAAW;gBACb,MAAM,SAAS,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;gBACtC,WAAW;oBAAE,GAAG,QAAQ;oBAAE,GAAG,MAAM;gBAAC;YACtC;QACF,EAAE,OAAO,YAAY;YACnB,QAAQ,IAAI,CAAC;QACf;QAEA,+DAA+D;QAC/D,MAAM,QAAQ,CAAC,wFAAqB,EAAE,OAAO;QAC7C,IAAI,WAAW,MAAM,aAAa;YAAE,gBAAgB;QAAK;QAEzD,4BAA4B;QAC5B,IAAI,SAAS,KAAK,KAAK,UAAU,SAAS,KAAK,KAAK,UAAU;YAC5D,WAAW,SAAS,MAAM,CAAC,SAAS,KAAK,KAAK,SAAS,IAAI;QAC7D;QAEA,qCAAqC;QACrC,IAAI,SAAS,SAAS,KAAK,UAAU;YACnC,WAAW,SAAS,OAAO,CAAC;gBAC1B,OAAO;gBACP,IAAI;gBACJ,IAAI;gBACJ,IAAI;gBACJ,IAAI;gBACJ,IAAI;YACN;QACF,OAAO,IAAI,SAAS,SAAS,KAAK,YAAY;YAC5C,WAAW,SAAS,OAAO,CAAC;gBAC1B,OAAO;gBACP,IAAI;gBACJ,IAAI;YACN;QACF;QAEA,0BAA0B;QAC1B,IAAI,SAAS,KAAK,KAAK,UAAU;YAC/B,WAAW,SAAS,QAAQ,CAAC;gBAC3B,YAAY;gBACZ,YAAY;YACd,GAAG,MAAM,CAAC,MAAM,CAAE,MAAM,OAAQ,wBAAwB;QAC1D;QAEA,+BAA+B;QAC/B,IAAI,SAAS,SAAS,KAAK,WAAW,SAAS,SAAS,KAAK,SAAS;YACpE,WAAW,SAAS,GAAG,CAAC;gBACtB,SAAS;gBACT,kBAAkB;gBAClB,mBAAmB;YACrB;QACF,OAAO;YACL,6CAA6C;YAC7C,IAAI,kBAAkB,gBAAgB,kBAAkB,aAAa;gBACnE,WAAW,SAAS,IAAI,CAAC;oBACvB,SAAS;oBACT,SAAS;oBACT,qBAAqB;oBACrB,oBAAoB;gBACtB;YACF,OAAO;gBACL,WAAW,SAAS,GAAG,CAAC;oBACtB,SAAS;oBACT,kBAAkB;gBACpB;YACF;QACF;QAEA,MAAM,iBAAiB,MAAM,SAAS,QAAQ;QAC9C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0CAA0C;QACxD,8CAA8C;QAC9C,OAAO;IACT;AACF"}}]
}