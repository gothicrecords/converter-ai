{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\n\r\n// Enforce canonical host and HTTPS in production\r\nexport function middleware(request) {\r\n  // Allow disabling middleware via environment variable\r\n  if (process.env.DISABLE_REDIRECT_MIDDLEWARE === 'true') {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  const url = request.nextUrl.clone();\r\n  const host = request.headers.get('host') || '';\r\n  const hostLower = host.toLowerCase();\r\n  \r\n  // Only run in Vercel production environment\r\n  const vercelEnv = process.env.VERCEL_ENV;\r\n  if (vercelEnv !== 'production') {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Determine primary domain from env\r\n  let envUrl = process.env.NEXT_PUBLIC_URL || process.env.APP_URL || '';\r\n  let primaryHost = '';\r\n  try {\r\n    if (envUrl) {\r\n      // Normalize to HTTPS in production (Vercel always uses HTTPS)\r\n      if (envUrl.startsWith('http://')) {\r\n        envUrl = envUrl.replace('http://', 'https://');\r\n      } else if (!envUrl.startsWith('https://') && !envUrl.startsWith('http://')) {\r\n        // If no protocol specified, assume HTTPS\r\n        envUrl = `https://${envUrl}`;\r\n      }\r\n      const parsedUrl = new URL(envUrl);\r\n      primaryHost = parsedUrl.host.toLowerCase();\r\n      // Remove www. from primaryHost if present to avoid loops\r\n      if (primaryHost.startsWith('www.')) {\r\n        primaryHost = primaryHost.substring(4);\r\n      }\r\n    }\r\n  } catch (e) {\r\n    // Invalid URL, skip redirect\r\n    return NextResponse.next();\r\n  }\r\n  \r\n  // If no primary host configured, skip redirect\r\n  if (!primaryHost) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Normalize current host (remove www. if present for comparison)\r\n  let currentHostNormalized = hostLower;\r\n  if (currentHostNormalized.startsWith('www.')) {\r\n    currentHostNormalized = currentHostNormalized.substring(4);\r\n  }\r\n\r\n  // Safety check: prevent redirect loops by checking if we're already on the target\r\n  if (currentHostNormalized === primaryHost) {\r\n    // If current host has www. but target doesn't, redirect to remove www\r\n    if (hostLower.startsWith('www.')) {\r\n      url.host = primaryHost;\r\n      url.protocol = 'https:';\r\n      // Double check to prevent loop - ensure we're not redirecting to the same host\r\n      const targetHost = url.host.toLowerCase();\r\n      if (targetHost !== hostLower && targetHost === primaryHost) {\r\n        return NextResponse.redirect(url, 308);\r\n      }\r\n    }\r\n    // Already on correct domain, no redirect needed\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Redirect www to apex (non-www) - only if different\r\n  if (hostLower === `www.${primaryHost}`) {\r\n    url.host = primaryHost;\r\n    url.protocol = 'https:';\r\n    // Final safety check - ensure target is different from current\r\n    const targetHost = url.host.toLowerCase();\r\n    if (targetHost !== hostLower && targetHost === primaryHost) {\r\n      return NextResponse.redirect(url, 308);\r\n    }\r\n  }\r\n\r\n  // Redirect vercel.app preview URLs to primary domain (only if different)\r\n  const isVercelHost = hostLower.endsWith('.vercel.app');\r\n  if (isVercelHost && currentHostNormalized !== primaryHost) {\r\n    url.host = primaryHost;\r\n    url.protocol = 'https:';\r\n    // Final safety check - ensure target is different from current\r\n    const targetHost = url.host.toLowerCase();\r\n    if (targetHost !== hostLower && targetHost === primaryHost) {\r\n      return NextResponse.redirect(url, 308);\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    // Run on all routes except Next internals and static assets\r\n    '/((?!_next/static|_next/image|favicon.ico|robots.txt|sitemap.xml|.*\\\\.(?:svg|jpg|jpeg|png|gif|webp|ico|css|js)$).*)',\r\n  ],\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGO,SAAS,WAAW,OAAO;IAChC,sDAAsD;IACtD,IAAI,QAAQ,GAAG,CAAC,2BAA2B,KAAK,QAAQ;QACtD,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;IACjC,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,WAAW;IAC5C,MAAM,YAAY,KAAK,WAAW;IAElC,4CAA4C;IAC5C,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;IACxC,IAAI,cAAc,cAAc;QAC9B,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,oCAAoC;IACpC,IAAI,SAAS,6DAA+B,QAAQ,GAAG,CAAC,OAAO,IAAI;IACnE,IAAI,cAAc;IAClB,IAAI;QACF,IAAI,QAAQ;YACV,8DAA8D;YAC9D,IAAI,OAAO,UAAU,CAAC,YAAY;gBAChC,SAAS,OAAO,OAAO,CAAC,WAAW;YACrC,OAAO,IAAI,CAAC,OAAO,UAAU,CAAC,eAAe,CAAC,OAAO,UAAU,CAAC,YAAY;gBAC1E,yCAAyC;gBACzC,SAAS,CAAC,QAAQ,EAAE,QAAQ;YAC9B;YACA,MAAM,YAAY,IAAI,IAAI;YAC1B,cAAc,UAAU,IAAI,CAAC,WAAW;YACxC,yDAAyD;YACzD,IAAI,YAAY,UAAU,CAAC,SAAS;gBAClC,cAAc,YAAY,SAAS,CAAC;YACtC;QACF;IACF,EAAE,OAAO,GAAG;QACV,6BAA6B;QAC7B,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,+CAA+C;IAC/C,IAAI,CAAC,aAAa;QAChB,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,iEAAiE;IACjE,IAAI,wBAAwB;IAC5B,IAAI,sBAAsB,UAAU,CAAC,SAAS;QAC5C,wBAAwB,sBAAsB,SAAS,CAAC;IAC1D;IAEA,kFAAkF;IAClF,IAAI,0BAA0B,aAAa;QACzC,sEAAsE;QACtE,IAAI,UAAU,UAAU,CAAC,SAAS;YAChC,IAAI,IAAI,GAAG;YACX,IAAI,QAAQ,GAAG;YACf,+EAA+E;YAC/E,MAAM,aAAa,IAAI,IAAI,CAAC,WAAW;YACvC,IAAI,eAAe,aAAa,eAAe,aAAa;gBAC1D,OAAO,gMAAY,CAAC,QAAQ,CAAC,KAAK;YACpC;QACF;QACA,gDAAgD;QAChD,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,qDAAqD;IACrD,IAAI,cAAc,CAAC,IAAI,EAAE,aAAa,EAAE;QACtC,IAAI,IAAI,GAAG;QACX,IAAI,QAAQ,GAAG;QACf,+DAA+D;QAC/D,MAAM,aAAa,IAAI,IAAI,CAAC,WAAW;QACvC,IAAI,eAAe,aAAa,eAAe,aAAa;YAC1D,OAAO,gMAAY,CAAC,QAAQ,CAAC,KAAK;QACpC;IACF;IAEA,yEAAyE;IACzE,MAAM,eAAe,UAAU,QAAQ,CAAC;IACxC,IAAI,gBAAgB,0BAA0B,aAAa;QACzD,IAAI,IAAI,GAAG;QACX,IAAI,QAAQ,GAAG;QACf,+DAA+D;QAC/D,MAAM,aAAa,IAAI,IAAI,CAAC,WAAW;QACvC,IAAI,eAAe,aAAa,eAAe,aAAa;YAC1D,OAAO,gMAAY,CAAC,QAAQ,CAAC,KAAK;QACpC;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP,4DAA4D;QAC5D;KACD;AACH"}}]
}